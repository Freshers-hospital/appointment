<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Super Admin Dashboard</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    .flatpickr-calendar {
      border-radius: 16px !important;
      box-shadow: 0 2px 16px rgba(0, 0, 0, 0.08) !important;
      border: none !important;
      width: 320px !important;
      background: #fff !important;
      font-family: "Segoe UI", Arial, sans-serif;
    }

    .flatpickr-months {
      background: #fff !important;
      color: #222 !important;
      border-radius: 16px 16px 0 0 !important;
      padding: 12px 0 0 0 !important;
      margin-bottom: 0 !important;
    }

    .flatpickr-current-month {
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      font-size: 1.3em !important;
      font-weight: 700 !important;
      color: #222 !important;
      height: 40px !important;
      margin-bottom: 0 !important;
    }

    .flatpickr-current-month .flatpickr-monthDropdown-months,
    .flatpickr-current-month .numInputWrapper {
      color: #222 !important;
      font-weight: 700 !important;
    }

    .flatpickr-day {
      color: #222 !important;
      font-weight: 500 !important;
      background: transparent !important;
      border-radius: 50% !important;
      border: none !important;
      transition: background 0.2s, color 0.2s;
      margin: 2px 0 !important;
    }

    .flatpickr-day.selected,
    .flatpickr-day.today {
      background: #1677ff !important;
      color: #fff !important;
      border-radius: 50% !important;
    }

    .flatpickr-day:hover,
    .flatpickr-day:focus {
      background: #e6f0ff !important;
      color: #1677ff !important;
    }

    .flatpickr-weekdays {
      background: #fff !important;
      color: #bdbdbd !important;
      font-weight: 600 !important;
      border: none !important;
    }

    .flatpickr-weekday {
      color: #bdbdbd !important;
      font-weight: 600 !important;
      border: none !important;
    }

    .flatpickr-day.disabled,
    .flatpickr-day.nextMonthDay,
    .flatpickr-day.prevMonthDay {
      color: #e0e0e0 !important;
      background: transparent !important;
      cursor: not-allowed !important;
    }

    .flatpickr-months .flatpickr-prev-month,
    .flatpickr-months .flatpickr-next-month {
      color: #bdbdbd !important;
      fill: #bdbdbd !important;
      top: 16px !important;
    }

    .flatpickr-day.today:not(.selected) {
      background: #f3f4f6 !important;
      color: #222 !important;
      border-radius: 50% !important;
      border: none !important;
    }

    .flatpickr-current-month .numInputWrapper,
    .flatpickr-current-month .flatpickr-year {
      display: none !important;
    }

    .flatpickr-current-month {
      justify-content: center !important;
    }
  </style>
</head>

<body class="bg-gray-100 font-sans">
  <nav class="bg-white shadow py-2 px-[110px]">
    <div class="flex justify-between items-center">
      <div class="flex items-center">
        <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
        </svg>
        <h1 class="text-xl font-bold text-blue-600"> MediCare </h1>
      </div>
      <!-- <div class="flex items-center">
        <div class="mr-4 font-bold text-sm text-black" id="userName"></div>
        <button onclick="document.getElementById('logoutModal').classList.remove('hidden')"
          class="bg-red-500 hover:bg-red-600 text-white rounded-full p-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M16 17l5-5m0 0l-5-5m5 5H9m4 5v1a2 2 0 01-2 2H7a2 2 0 01-2-2V6a2 2 0 012-2h4a2 2 0 012 2v1" />
          </svg>
        </button>
      </div> -->
      <div class="flex items-center">
        <div class="mr-4 font-bold text-sm text-black" id="userName"></div>
        <div class="flex items-center relative">
          <div class="mr-2 font-bold text-sm text-black cursor-pointer flex items-center gap-1" id="userDropdownToggle">
            <svg width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <rect x="0" fill="none" width="24" height="24" />
              <g>
                <path d="M7 10l5 5 5-5" />
              </g>
            </svg>
          </div>
          <div id="userDropdownMenu"
            class="absolute right-0 mt-32 w-44 bg-white border border-gray-200 rounded shadow-md hidden z-50">
            <ul class="py-1 text-sm text-gray-700">
              <li>
                <a href="" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100 transition-colors duration-150">
                  <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M16.5 7.063C16.5 10.258 14.57 13 12 13c-2.572 0-4.5-2.742-4.5-5.938C7.5 3.868 9.16 2 12 2s4.5 1.867 4.5 5.063zM4.102 20.142C4.487 20.6 6.145 22 12 22c5.855 0 7.512-1.4 7.898-1.857a.416.416 0 0 0 .09-.317C19.9 18.944 19.106 15 12 15s-7.9 3.944-7.989 4.826a.416.416 0 0 0 .091.317z"
                      fill="#000000" />
                  </svg>
                  <span>Profile</span>
                </a>
              </li>
              <li>
                <button onclick="document.getElementById('logoutModal').classList.remove('hidden')"
                  class="w-full flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-gray-100 transition-colors duration-150">
                  <svg width="20px" height="20px" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M1 1L8 1V2L2 2L2 13H8V14H1L1 1ZM10.8536 4.14645L14.1932 7.48614L10.8674 11.0891L10.1326 10.4109L12.358 8L4 8V7L12.2929 7L10.1464 4.85355L10.8536 4.14645Z"
                      fill="#ff0000" />
                  </svg>
                  <span>Logout</span>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="p-8">


    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4">
      <div>
        <h2 class="text-2xl font-semibold px-20">Super Admin Dashboard</h2>
        <p class="text-gray-500 px-20">Manage admins and doctors</p>
      </div>
    </div>


    <div class="px-20 mt-4">
      <div class="bg-gray-200 p-1 rounded-lg flex items-center mb-6">
        <button
          class="tab flex-1 text-center py-1.5 font-semibold transition-colors duration-200 tab-active bg-white shadow rounded"
          data-tab="adminsTab">Admins</button>
        <button class="tab flex-1 text-center py-1.5 font-semibold transition-colors duration-200 tab-inactive"
          data-tab="doctorsTab">Doctors</button>
      </div>
    </div>

    <div class="px-20">
      <div class="bg-white p-6 rounded-xl shadow">
        <div class="space-y-10">

          <div id="adminsTab" class="tab-content">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-semibold">Admins List</h3>

              <a href="adminregister.html" class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-700">+ Add
                Admin</a>
            </div>

            <div
              class="grid grid-cols-12 gap-4 px-4 py-3 text-left text-sm font-bold bg-gray-50 text-gray-800 border-b">
              <div class="col-span-3">Admin Name</div>
              <div class="col-span-3">Email</div>
              <div class="col-span-2">Contact</div>
              <div class="col-span-2">Status</div>
              <div class="col-span-2 text-right">Action</div>
            </div>

            <div id="adminList" class="space-y-2 mt-2">

              <div class="col-span-2 text-right">
                <button class="action-btn text-gray-600 hover:text-black focus:outline-none text-xl">â‹¯</button>
                <div
                  class="action-menu absolute right-4 mt-2 w-24 bg-white border border-gray-200 rounded shadow-md hidden z-10">
                  <button onclick="openViewModal(this)" data-name="Sandeep Kumar" data-email="sandeep@example.com"
                    data-contact="+91 9876543210" data-status="Active"
                    class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">View</button>
                  <button onclick="document.getElementById('editModal').classList.remove('hidden')"
                    class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                    Edit
                  </button>
                  <button onclick="document.getElementById('deleteModal').classList.remove('hidden')"
                    class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100">
                    Delete
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="doctorsTab" class="tab-content hidden">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold mb-1">Doctors List</h3>
            <!-- <p class="text-gray-500 mt-0">Manage doctor profiles and schedules</p> -->
            <div class="flex flex-row items-center space-x-3">
              <div class="relative w-60 mt-0 h-12">
                <div id="datePickerDisplay"
                  class="flex items-center justify-center w-44 h-12 py-0 rounded bg-white border border-gray-800 cursor-pointer focus:ring-2 focus:ring-gray-400 select-none text-base">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-400" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <rect x="3" y="4" width="18" height="18" rx="2" fill="#e5e7eb" />
                    <path stroke="#9ca3af" stroke-width="2" d="M8 2v4M16 2v4M3 10h18" />
                  </svg>
                  <span id="datePickerText" class="text-gray-900 font-semibold text-base">2025-06-23</span>
                </div>
                <input type="text" id="datePicker" style="position: absolute; left: -9999px" readonly
                  autocomplete="off" />
              </div>
              <button id="addDoctorBtn" class="bg-black text-white px-6 h-12 flex items-center rounded font-semibold">+
                Add Doctor</button>
            </div>
          </div>

          <div
            class="hidden md:grid grid-cols-12 gap-4 px-4 py-3 text-left text-sm font-bold bg-gray-50 text-gray-800 border-b">
            <div class="col-span-3">Doctor</div>
            <div class="col-span-2">Specialization</div>
            <div class="col-span-2">Today's Appointments</div>
            <div class="col-span-3">Availability</div>
            <div class="col-span-2">Actions</div>
          </div>
          <div id="doctorsList" class="space-y-2 mt-2"></div>
          <div id="doctorsPagination" class="flex justify-center items-center space-x-2 mt-4 hidden">
            <button id="prevDoctorsPage"
              class="px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">Previous</button>
            <span id="doctorsPageInfo" class="text-sm text-gray-600"></span>
            <button id="nextDoctorsPage"
              class="px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">Next</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

  <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 hidden">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl px-10 py-8 relative">
      <div class="mb-6 border-b pb-4">
        <h2 class="text-3xl font-semibold text-gray-800">Edit Admin</h2>
        <p class="text-sm text-gray-500 mt-1">Update administrator information</p>
      </div>
      <div class="grid grid-cols-2 gap-6">
        <div>
          <label for="editName" class="text-sm text-gray-500 mb-1 block">Full Name</label>
          <input id="editName" type="text"
            class="w-full px-4 py-3 border border-gray-300 rounded-md text-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
            placeholder="Enter name" />
        </div>
        <div>
          <label for="editEmail" class="text-sm text-gray-500 mb-1 block">Email Address</label>
          <input id="editEmail" type="email"
            class="w-full px-4 py-3 border border-gray-300 rounded-md text-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
            placeholder="Enter email" />
        </div>
        <div>
          <label for="editContact" class="text-sm text-gray-500 mb-1 block">Contact Number</label>
          <input id="editContact" type="text"
            class="w-full px-4 py-3 border border-gray-300 rounded-md text-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
            placeholder="Enter contact number" />
        </div>
        <div>
          <label class="text-sm text-gray-500 mb-1 block">Account Status</label>
          <div id="editStatusDisplay"
            class="bg-gray-100 border border-gray-300 text-gray-700 rounded-md px-4 py-3 text-lg font-medium shadow-sm capitalize">
            -
          </div>
        </div>
      </div>


      <div class="flex justify-end mt-8 gap-4">
        <button onclick="closeModals()"
          class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium px-6 py-2 rounded-md">Cancel</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-md shadow">Save</button>
      </div>
    </div>
  </div>


  <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden z-50">
    <div class="bg-white p-6 rounded shadow-lg w-full max-w-sm text-center">
      <h2 class="text-xl font-semibold mb-4">Confirm Delete</h2>
      <p class="mb-4 text-gray-600">Are you sure you want to delete this admin?</p>
      <div class="flex justify-center gap-4">
        <button onclick="closeModals()" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
        <button onclick="confirmDelete()" class="px-4 py-2 bg-red-600 text-white rounded">Delete</button>


      </div>
    </div>
  </div>


  <div id="viewModal" class="fixed inset-0 z-50 bg-black bg-opacity-40 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl px-10 py-8 relative">


      <div class="mb-6 border-b pb-4">
        <h2 class="text-3xl font-semibold text-gray-800">Admin Profile</h2>
        <p class="text-sm text-gray-500 mt-1">Detailed administrator information</p>
      </div>

      <div class="grid grid-cols-2 gap-6">
        <div>
          <label class="text-sm text-gray-500 mb-1 block">Full Name</label>
          <div id="viewAdminName" class="bg-gray-50 border rounded-md px-4 py-3 text-lg font-medium text-gray-900">-
          </div>
        </div>

        <div>
          <label class="text-sm text-gray-500 mb-1 block">Email Address</label>
          <div id="viewAdminEmail"
            class="bg-gray-50 border rounded-md px-4 py-3 text-lg font-medium text-gray-900 break-all">-</div>
        </div>

        <div>
          <label class="text-sm text-gray-500 mb-1 block">Contact Number</label>
          <div id="viewAdminContact" class="bg-gray-50 border rounded-md px-4 py-3 text-lg font-medium text-gray-900">-
          </div>
        </div>

        <div>
          <label class="text-sm text-gray-500 mb-1 block">Account Status</label>
          <div id="viewAdminStatus"
            class="bg-green-50 border border-green-200 text-green-800 rounded-md px-4 py-3 text-lg font-semibold capitalize">
            -
          </div>
        </div>
      </div>


      <div class="mt-8 flex justify-end">
        <button onclick="closeModals()"
          class="bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-2 rounded-md shadow">
          Close
        </button>
      </div>
    </div>
  </div>

  <div id="logoutModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden z-50">
    <div class="bg-white p-6 rounded shadow-lg w-full max-w-sm text-center">
      <h2 class="text-xl font-semibold mb-4">Logout</h2>
      <p class="mb-4 text-gray-600">Are you sure you want to logout?</p>
      <div class="flex justify-center gap-4">
        <button onclick="closeModals()" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
        <button onclick="logout()" class="px-4 py-2 bg-red-600 text-white rounded">Logout</button>
      </div>
    </div>
  </div>

  <div id="viewDoctorProfileModalOverlay"
    class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div id="viewDoctorProfileModal" class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-lg relative">
      <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Doctor Profile</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
          <p class="text-gray-500 text-sm mb-1">Name</p>
          <p id="profileDoctorName" class="text-gray-800 font-semibold text-base truncate"></p>
        </div>
        <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
          <p class="text-gray-500 text-sm mb-1">Specialization</p>
          <p id="profileDoctorSpecialty" class="text-gray-800 font-semibold text-base truncate"></p>
        </div>
        <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
          <p class="text-gray-500 text-sm mb-1">Experience</p>
          <p id="profileDoctorExperience" class="text-gray-800 font-semibold text-base truncate"></p>
        </div>
        <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
          <p class="text-gray-500 text-sm mb-1">Availability</p>
          <p id="profileDoctorAvailability" class="text-gray-800 font-semibold text-base truncate"></p>
        </div>
        <div id="profileDoctorAgeWrapper" class="bg-gray-50 p-4 rounded-lg shadow-sm">
          <p class="text-gray-500 text-sm mb-1">Age</p>
          <p id="profileDoctorAge" class="text-gray-800 font-semibold text-base truncate"></p>
        </div>
        <div id="profileDoctorGenderWrapper" class="bg-gray-50 p-4 rounded-lg shadow-sm">
          <p class="text-gray-500 text-sm mb-1">Gender</p>
          <p id="profileDoctorGender" class="text-gray-800 font-semibold text-base truncate"></p>
        </div>
        <div id="profileDoctorPhoneWrapper" class="bg-gray-50 p-4 rounded-lg shadow-sm">
          <p class="text-gray-500 text-sm mb-1">Phone Number</p>
          <p id="profileDoctorPhone" class="text-gray-800 font-semibold text-base truncate"></p>
        </div>
        <div id="profileDoctorAddressWrapper" class="bg-gray-50 p-4 rounded-lg shadow-sm">
          <p class="text-gray-500 text-sm mb-1">Address</p>
          <p id="profileDoctorAddress" class="text-gray-800 font-semibold text-base truncate"></p>
        </div>
        <div class="sm:col-span-2 bg-gray-50 p-4 rounded-lg shadow-sm">
          <p class="text-gray-500 text-sm mb-1">Qualification</p>
          <p id="profileDoctorQualification" class="text-gray-800 font-semibold text-base break-words"></p>
        </div>
      </div>
      <div class="flex justify-center mt-6">
        <button id="closeViewDoctorProfileBtn"
          class="px-6 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition">Close</button>
      </div>
    </div>
  </div>
  <div id="editDoctorProfileModalOverlay"
    class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-lg max-h-screen overflow-y-auto relative">
      <button id="closeEditDoctorProfileModal"
        class="absolute top-4 right-4 text-red-500 hover:text-red-700 text-2xl">&times;</button>
      <h2 class="text-xl font-bold text-center mb-4 text-gray-800">Edit Doctor Profile</h2>
      <form id="editDoctorForm" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="sm:col-span-2 flex flex-col items-center mb-2">
          <label class="text-sm font-semibold text-gray-600 block mb-2">Profile Photo</label>
          <div style="position: relative; width: 96px; height: 96px; margin-bottom: 0.5rem">
            <img id="editDoctorPhotoPreview" src="" alt="" class="w-24 h-24 rounded-full object-cover border shadow"
              style="display: none; position: absolute; top: 0; left: 0" />
            <div id="editDoctorDefaultIcon" style="
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 96px;
                            height: 96px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            background: #f3f4f6;
                            border-radius: 50%;
                        ">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2" fill="none" />
                <path stroke="currentColor" stroke-width="2" d="M4 20c0-4 4-7 8-7s8 3 8 7" fill="none" />
              </svg>
            </div>
          </div>
          <input type="file" id="editDoctorPhoto" accept="image/*" class="hidden" />
          <button type="button" onclick="document.getElementById('editDoctorPhoto').click()"
            class="px-2 py-1 rounded bg-gray-200 hover:bg-gray-300 text-xs font-medium">
            Choose Photo
          </button>
        </div>
        <div class="bg-gray-50 p-3 rounded-lg shadow-sm">
          <label class="text-sm font-medium text-gray-600 mb-1 block">Name</label>
          <input type="text" id="editDoctorName" name="name"
            class="w-full border rounded px-2 py-1 focus:ring-2 focus:ring-blue-500" required />
        </div>
        <div class="bg-gray-50 p-3 rounded-lg shadow-sm">
          <label class="text-sm font-medium text-gray-600 mb-1 block">Specialization</label>
          <input type="text" id="editDoctorSpecialization" name="specialty"
            class="w-full border rounded px-2 py-1 focus:ring-2 focus:ring-blue-500" required />
        </div>
        <div class="bg-gray-50 p-3 rounded-lg shadow-sm">
          <label class="text-sm font-medium text-gray-600 mb-1 block">Experience</label>
          <input type="text" id="editDoctorExperience" name="experience"
            class="w-full border rounded px-2 py-1 focus:ring-2 focus:ring-blue-500" />
        </div>
        <div class="bg-gray-50 p-3 rounded-lg shadow-sm">
          <label class="text-sm font-medium text-gray-600 mb-1 block">Availability</label>
          <input type="text" id="editDoctorAvailability" name="availability"
            class="w-full border rounded px-2 py-1 focus:ring-2 focus:ring-blue-500" />
        </div>
        <div class="bg-gray-50 p-3 rounded-lg shadow-sm">
          <label class="text-sm font-medium text-gray-600 mb-1 block">Age</label>
          <input type="number" id="editDoctorAge" name="age"
            class="w-full border rounded px-2 py-1 focus:ring-2 focus:ring-blue-500" min="1" max="120" />
        </div>
        <div class="bg-gray-50 p-3 rounded-lg shadow-sm">
          <label class="text-sm font-medium text-gray-600 mb-1 block">Gender</label>
          <select id="editDoctorGender" name="gender"
            class="w-full border rounded px-2 py-1 focus:ring-2 focus:ring-blue-500">
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="bg-gray-50 p-3 rounded-lg shadow-sm">
          <label class="text-sm font-medium text-gray-600 mb-1 block">Phone Number</label>
          <input type="tel" id="editDoctorPhone" name="phone"
            class="w-full border rounded px-2 py-1 focus:ring-2 focus:ring-blue-500" pattern="^[6-9][0-9]{9}$"
            maxlength="10" title="Phone number must be 10 digits and start with 6, 7, 8, or 9." required />
        </div>
        <div class="bg-gray-50 p-3 rounded-lg shadow-sm">
          <label class="text-sm font-medium text-gray-600 mb-1 block">Qualification</label>
          <input type="text" id="editDoctorQualification" name="qualification"
            class="w-full border rounded px-2 py-1 focus:ring-2 focus:ring-blue-500" />
        </div>
        <div class="sm:col-span-2 bg-gray-50 p-3 rounded-lg shadow-sm">
          <label class="text-sm font-medium text-gray-600 mb-1 block">Address</label>
          <textarea id="editDoctorAddress" name="address"
            class="w-full border rounded px-2 py-1 focus:ring-2 focus:ring-blue-500" rows="2"></textarea>
        </div>
        <div class="sm:col-span-2 flex justify-between pt-3 gap-3">
          <button type="button" id="cancelEditDoctorBtn"
            class="w-1/2 py-2 border border-gray-300 rounded-lg bg-white text-gray-700 font-semibold hover:bg-gray-100">Cancel</button>
          <button type="submit"
            class="w-1/2 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700">Save</button>
        </div>
      </form>
    </div>
  </div>
  <div id="availabilityModalOverlay"
    class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div id="availabilityModal" class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-lg relative">
      <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Manage Availability</h2>
      <form id="availabilityForm" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="bg-gray-50 p-4 rounded-lg shadow-sm col-span-2">
          <p class="text-gray-500 text-sm mb-1">Select Date</p>
          <input type="text" id="availabilityDate" name="date"
            class="w-full px-4 py-2 border border-gray-300 rounded-md text-base focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="MM/DD/YYYY" required readonly />
        </div>
        <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
          <p class="text-gray-500 text-sm mb-1">Start Time</p>
          <input type="text" id="availabilityStart" name="start"
            class="w-full px-4 py-2 border border-gray-300 rounded-md text-center text-base focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="10:00 AM" required />
        </div>
        <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
          <p class="text-gray-500 text-sm mb-1">End Time</p>
          <input type="text" id="availabilityEnd" name="end"
            class="w-full px-4 py-2 border border-gray-300 rounded-md text-center text-base focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="05:00 PM" required />
        </div>
        <div class="col-span-2 flex justify-center gap-4 mt-4">
          <button type="button" id="cancelAvailability"
            class="px-6 py-2 bg-white border border-gray-300 text-black rounded-lg font-semibold hover:bg-gray-100 transition">Cancel</button>
          <button type="submit"
            class="px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">Save</button>
        </div>
      </form>
      <button id="closeAvailabilityModal"
        class="absolute top-4 right-4 text-red-500 hover:text-red-700 text-2xl">&times;</button>
    </div>
  </div>
  <div id="addDoctorModalOverlay"
    class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div id="addDoctorModal" class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md relative">
      <button id="closeAddDoctorModal"
        class="absolute top-4 right-4 text-red-500 hover:text-red-700 text-2xl">&times;</button>
      <h2 class="text-2xl font-bold mb-6 text-gray-800">Add Doctor</h2>
      <form id="addDoctorForm">
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label for="doctorFirstName" class="block text-gray-700 text-sm font-semibold mb-2">First Name</label>
            <input type="text" id="doctorFirstName" name="firstName"
              class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
              required />
          </div>
          <div>
            <label for="doctorLastName" class="block text-gray-700 text-sm font-semibold mb-2">Last Name</label>
            <input type="text" id="doctorLastName" name="lastName"
              class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
              required />
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="mb-4">
            <label for="doctorSpecialty" class="block text-gray-700 text-sm font-semibold mb-2">Specialization</label>
            <input type="text" id="doctorSpecialty" name="specialty"
              class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
              required />
          </div>
          <div class="mb-4">
            <label for="doctorExperience" class="block text-gray-700 text-sm font-semibold mb-2">Experience</label>
            <input type="text" id="doctorExperience" name="experience"
              class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
          </div>
          <div class="mb-4 col-span-2">
            <label class="block text-gray-700 text-sm font-semibold mb-2">Qualification</label>
            <input type="text" name="qualification"
              class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 focus:outline-none"
              placeholder="e.g., Mbbs,Phd..." required />
          </div>
          <div class="mb-4 col-span-2">
            <label for="doctorAvailability" class="block text-gray-700 text-sm font-semibold mb-2">Availability</label>
            <input type="text" id="doctorAvailability" name="availability"
              class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
              placeholder="e.g., 9:00 AM - 5:00 PM" required />
          </div>
        </div>
        <div id="doctorErrorMsg" style="display: none; color: red; margin-top: 8px"></div>
        <div class="flex justify-end mt-4">
          <button type="submit"
            class="px-8 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors duration-200">Add</button>
        </div>
      </form>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        tabs.forEach((t) => t.classList.remove('tab-active', 'bg-white', 'shadow', 'rounded'));
        tabs.forEach((t) => t.classList.add('tab-inactive'));
        tab.classList.remove('tab-inactive');
        tab.classList.add('tab-active', 'bg-white', 'shadow', 'rounded');
        const targetId = tab.getAttribute('data-tab');
        tabContents.forEach((content) => content.classList.add('hidden'));
        document.getElementById(targetId).classList.remove('hidden');
        if (targetId === "doctorsTab") fetchAndDisplayDoctors();
        if (targetId === "adminsTab") fetchAdmins();
      });
    });

    window.addEventListener("click", function (e) {
      document.querySelectorAll(".action-menu").forEach((menu) => {
        if (!menu.contains(e.target) && !menu.previousElementSibling.contains(e.target)) {
          menu.classList.add("hidden");
        }
      });
    });
  </script>
  <script>
    function closeModals() {
      document.getElementById("editModal")?.classList.add("hidden");
      document.getElementById("deleteModal")?.classList.add("hidden");
      document.getElementById("logoutModal")?.classList.add("hidden");
      document.getElementById("viewModal")?.classList.add("hidden");
    }
  </script>


  <script>

    let allAdmins = [];
    let currentAdminsPage = 1;
    const adminsPerPage = 7;

    async function fetchAdmins() {
      const adminList = document.getElementById("adminList");
      adminList.innerHTML = `<div class="text-gray-500 text-center py-4">Loading admins...</div>`;

      try {
        const res = await fetch("/api/admin/getAllAdmins");

        const admins = await res.json();

        if (!admins.length) {
          adminList.innerHTML = `<div class="text-gray-500 text-center py-4">No admins found.</div>`;
          return;
        }

        allAdmins = admins;
        currentAdminsPage = 1;
        renderAdminsPage();
      } catch (err) {
        adminList.innerHTML = `<div class="text-red-500 text-center py-4">Failed to load admins.</div>`;
      }
    }

    function renderAdminsPage() {
      const adminList = document.getElementById("adminList");
      const totalPages = Math.ceil(allAdmins.length / adminsPerPage);
      const startIndex = (currentAdminsPage - 1) * adminsPerPage;
      const endIndex = startIndex + adminsPerPage;
      const currentAdmins = allAdmins.slice(startIndex, endIndex);
      if (!currentAdmins.length) {
        adminList.innerHTML = `<div class="text-gray-500 text-center py-4">No admins found.</div>`;
        updateAdminsPagination(totalPages);
        return;
      }
      adminList.innerHTML = currentAdmins.map(admin => `
        <div class="grid grid-cols-12 gap-4 items-center px-4 py-3 bg-white rounded-lg shadow text-sm relative">
          <div class="col-span-3 font-semibold text-gray-800">${admin.username}</div>
          <div class="col-span-3 text-gray-700">${admin.email}</div>
          <div class="col-span-2 text-gray-700">${admin.contact || '-'}</div>
          <div class="col-span-2">
           <span class="inline-block px-2 py-1 text-xs font-medium rounded ${
  admin.status?.toLowerCase() === 'active'
    ? 'text-green-800 bg-green-100'
    : 'text-red-800 bg-red-100'
}">
${admin.status?.toLowerCase() === 'active' ? 'Active' : 'InActive'}

</span>

          </div>
          <div class="col-span-2 text-right">
            <button class="action-btn text-gray-600 hover:text-black focus:outline-none text-xl">â‹¯</button>
            <div class="action-menu absolute right-4 mt-2 w-24 bg-white border border-gray-200 rounded shadow-md hidden z-10">
              <button onclick="openViewModal(this)" data-name="${admin.username}" data-email="${admin.email}" data-contact="${admin.contact || '-'}" data-status="${admin.status || 'Active'}" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">View</button>
              <button onclick="editAdmin('${admin._id}')" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Edit</button>
              <button onclick="deleteAdmin('${admin._id}')" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Delete</button>
            </div>
          </div>
        </div>
      `).join("");
      updateAdminsPagination(totalPages);
    }

    function updateAdminsPagination(totalPages) {
      let pagination = document.getElementById("adminsPagination");
      if (!pagination) {
        pagination = document.createElement("div");
        pagination.id = "adminsPagination";
        pagination.className = "flex justify-center items-center space-x-2 mt-4";
        document.getElementById("adminList").after(pagination);
      }
      if (totalPages > 1) {
        pagination.innerHTML = `
          <button id="prevAdminsPage" class="px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">Previous</button>
          <span id="adminsPageInfo" class="text-sm text-gray-600">Page ${currentAdminsPage} of ${totalPages}</span>
          <button id="nextAdminsPage" class="px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">Next</button>
        `;
        document.getElementById("prevAdminsPage").disabled = currentAdminsPage === 1;
        document.getElementById("nextAdminsPage").disabled = currentAdminsPage === totalPages;
        document.getElementById("prevAdminsPage").onclick = function () {
          if (currentAdminsPage > 1) {
            currentAdminsPage--;
            renderAdminsPage();
          }
        };
        document.getElementById("nextAdminsPage").onclick = function () {
          if (currentAdminsPage < totalPages) {
            currentAdminsPage++;
            renderAdminsPage();
          }
        };
        pagination.style.display = "flex";
      } else {
        pagination.innerHTML = "";
        pagination.style.display = "none";
      }
    }

    window.addEventListener("DOMContentLoaded", fetchAdmins);


    function openViewModal(btn) {
      document.getElementById('viewModal').classList.remove('hidden');
      document.getElementById('viewAdminName').textContent = btn.getAttribute('data-name');
      document.getElementById('viewAdminEmail').textContent = btn.getAttribute('data-email');
      document.getElementById('viewAdminContact').textContent = btn.getAttribute('data-contact');
      document.getElementById('viewAdminStatus').textContent = btn.getAttribute('data-status');
    }


    function editAdmin(id) {
      const admin = allAdmins.find(a => a._id === id);
      if (!admin) return;

      document.getElementById("editName").value = admin.username || '';
      document.getElementById("editEmail").value = admin.email || '';
      document.getElementById("editContact").value = admin.contact || '';
      document.getElementById("editStatusDisplay").textContent = admin.status || 'Active';


      document.getElementById("editModal").classList.remove("hidden");

      window.currentEditingAdminId = id;
    }


    let currentDeleteId = null;

    function deleteAdmin(id) {

      document.getElementById("deleteModal").classList.remove("hidden");
    }

    async function deleteAdmin(id) {
      const token = localStorage.getItem("admin_jwt");
      if (!token) {
        alert("You are not authorized. Please log in again.");
        return;
      }

      try {
        const res = await fetch(`/api/admin/deleteAdmin/${id}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`,
          },
          body: JSON.stringify({ status: "deleted" }),
        });

        if (!res.ok) {
          const errData = await res.json();
          throw new Error(errData.message || "Failed to delete admin");
        }

        alert("Admin deleted successfully");
        closeModals();
        fetchAdmins();
      } catch (err) {
        alert("Delete failed: " + err.message);
      }
    }


    function closeModals() {
      document.getElementById("editModal")?.classList.add("hidden");
      document.getElementById("deleteModal")?.classList.add("hidden");
      document.getElementById("logoutModal")?.classList.add("hidden");
      document.getElementById("viewModal")?.classList.add("hidden");
    }

    let allDoctors = [];
    let currentDoctorsPage = 1;
    const doctorsPerPage = 5;
    let todaysAppointmentsCountMap = {};

    async function fetchAndDisplayDoctors(currentDate) {
      try {
        const response = await fetch("/api/doctors");
        if (!response.ok) {
          throw new Error("Failed to fetch doctors");
        }
        allDoctors = await response.json();
        allDoctors.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        currentDoctorsPage = 1;
        const appointmentsRes = await fetch("/api/confirmations");
        const allAppointments = appointmentsRes.ok ? await appointmentsRes.json() : [];
        const formattedDate = new Date(currentDate || new Date()).toLocaleDateString("en-US", {
          month: "numeric",
          day: "numeric",
          year: "numeric",
        });
        todaysAppointmentsCountMap = {};
        allAppointments.forEach((app) => {
          if (app.dateData && app.dateData.date === formattedDate && app.status !== "canceled" && app.status !== "cancelled") {
            const doctorName = app.doctorData?.name || app.doctorName || "";
            if (doctorName) {
              todaysAppointmentsCountMap[doctorName] = (todaysAppointmentsCountMap[doctorName] || 0) + 1;
            }
          }
        });
        renderDoctorsPage();
      } catch (error) {
        console.error("Error fetching doctors:", error);
      }
    }

    async function renderDoctorsPage() {
      const doctorsList = document.getElementById("doctorsList");
      const paginationContainer = document.getElementById("doctorsPagination");
      if (!doctorsList) return;
      const totalPages = Math.ceil(allDoctors.length / doctorsPerPage);
      const startIndex = (currentDoctorsPage - 1) * doctorsPerPage;
      const endIndex = startIndex + doctorsPerPage;
      const currentDoctors = allDoctors.slice(startIndex, endIndex);
      doctorsList.innerHTML = "";
      const selectedDate = document.getElementById("datePicker")?.value || new Date().toISOString().split('T')[0];
      const availabilityPromises = currentDoctors.map(async (doctor) => {
        let displayAvailability = doctor.availability || "Available";
        try {
          const res = await fetch(`/api/doctors/${doctor._id}/availability?date=${selectedDate}`);
          if (res.ok) {
            const data = await res.json();
            if (data.start && data.end) {
              displayAvailability = `${data.start} - ${data.end}`;
            }
          }
        } catch (err) { }
        return displayAvailability;
      });
      const availabilities = await Promise.all(availabilityPromises);
      currentDoctors.forEach((doctor, idx) => {
        let infoLine = "";
        if (doctor.experience && doctor.qualification) {
          infoLine = `${doctor.experience} yrs exp. Â· ${doctor.qualification}`;
        } else if (doctor.experience) {
          infoLine = `${doctor.experience} yrs exp.`;
        } else if (doctor.qualification) {
          infoLine = `${doctor.qualification}`;
        }
        let count = 0;
        const doctorName = doctor.name;
        if (todaysAppointmentsCountMap && doctorName in todaysAppointmentsCountMap) {
          count = todaysAppointmentsCountMap[doctorName];
        }
        doctorsList.innerHTML += `
<div class="grid grid-cols-12 gap-4 items-center bg-white p-3 rounded-lg shadow-sm border border-gray-100 hover:shadow-md transition-shadow duration-200">
  <div class="col-span-3 flex items-center">
    <div class="w-8 h-8 rounded-full mr-4 flex-shrink-0 overflow-hidden bg-gray-200 doctor-photo-placeholder" data-doctor-id="${doctor._id}" data-doctor-index="${startIndex + idx}" style="cursor:pointer;">
      ${doctor.image
            ? `<img src="${doctor.image.startsWith("/uploads/") ? doctor.image : "/uploads/" + doctor.image}" alt="${doctor.name}" class="w-full h-full object-cover" />`
            : `<img src="/default-profile.png" alt="No Photo" class="w-full h-full object-cover opacity-50" />`
          }
    </div>
    <div>
      <div class="font-semibold text-gray-800">${doctor.name}</div>
      <div class="text-xs text-gray-500">${infoLine}</div>
    </div>
  </div>
  <div class="col-span-2 text-gray-600">${doctor.specialty || "General Medicine"}</div>
  <div class="col-span-2 text-gray-600">${count}</div>
  <div class="col-span-3 text-gray-600">${availabilities[idx]}</div>
  <div class="col-span-2 relative">
    <button class="action-btn text-xl">...</button>
    <div class="action-menu hidden absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-md shadow-lg py-1 z-20">
      <a href="#" class="view-profile-btn block px-4 py-2 hover:bg-gray-100 text-gray-700" data-doctor='${JSON.stringify(doctor)}'>View Profile</a>
      <a href="#" class="edit-doctor-profile-btn block px-4 py-2 hover:bg-gray-100 text-gray-700" data-doctor='${JSON.stringify(doctor)}'>Edit Profile</a>
      <a href="#" class="manage-availability-btn block px-4 py-2 hover:bg-gray-100 text-gray-700" data-doctor='${JSON.stringify(doctor)}'>Manage Availability</a>
    </div>
  </div>
</div>
`;
      });
      updateDoctorsPagination(totalPages);
    }

    function updateDoctorsPagination(totalPages) {
      const paginationContainer = document.getElementById("doctorsPagination");
      const prevButton = document.getElementById("prevDoctorsPage");
      const nextButton = document.getElementById("nextDoctorsPage");
      const pageInfo = document.getElementById("doctorsPageInfo");
      if (!paginationContainer) return;
      if (totalPages > 1) {
        paginationContainer.classList.remove("hidden");
      } else {
        paginationContainer.classList.add("hidden");
      }
      pageInfo.textContent = `Page ${currentDoctorsPage} of ${totalPages}`;
      prevButton.disabled = currentDoctorsPage === 1;
      nextButton.disabled = currentDoctorsPage === totalPages;
    }

    document.addEventListener("DOMContentLoaded", function () {
      const prevButton = document.getElementById("prevDoctorsPage");
      const nextButton = document.getElementById("nextDoctorsPage");
      if (prevButton) {
        prevButton.addEventListener("click", () => {
          if (currentDoctorsPage > 1) {
            currentDoctorsPage--;
            renderDoctorsPage();
          }
        });
      }
      if (nextButton) {
        nextButton.addEventListener("click", () => {
          const totalPages = Math.ceil(allDoctors.length / doctorsPerPage);
          if (currentDoctorsPage < totalPages) {
            currentDoctorsPage++;
            renderDoctorsPage();
          }
        });
      }
    });
    document.addEventListener("DOMContentLoaded", function () {
      const datePicker = document.getElementById("datePicker");
      const datePickerText = document.getElementById("datePickerText");
      flatpickr("#datePicker", {
        dateFormat: "Y-m-d",
        allowInput: false,
        defaultDate: new Date(),
        static: true,
        onReady: function (selectedDates, dateStr, instance) {
          const monthElem = instance.calendarContainer.querySelector(".flatpickr-current-month");
          if (monthElem) {
            const yearInput = monthElem.querySelector(".numInputWrapper");
            if (yearInput) yearInput.style.display = "none";
            const yearDropdown = monthElem.querySelector(".flatpickr-yearDropdown-years");
            if (yearDropdown) yearDropdown.style.display = "none";
            const yearSpan = monthElem.querySelector(".flatpickr-year");
            if (yearSpan) yearSpan.style.display = "none";
            monthElem.style.justifyContent = "center";
            const monthName = monthElem.querySelector(".cur-month");
            if (monthName) {
              monthName.style.fontWeight = "bold";
              monthName.style.fontSize = "1.3em";
            }
          }
        },
        onChange: function (selectedDates, dateStr, instance) {
          const displayText = selectedDates[0]?.toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" }) || "";
          document.getElementById("datePickerText").textContent = displayText;
          document.getElementById("datePicker").value = dateStr;
          fetchAndDisplayDoctors(dateStr);
        },
      });
      document.getElementById("datePickerDisplay").addEventListener("click", function () {
        if (document.getElementById("datePicker")._flatpickr) {
          document.getElementById("datePicker")._flatpickr.open();
        }
      });
      document.getElementById("datePicker").style.color = "transparent";
      const today = new Date();
      document.getElementById("datePicker").value = today.toISOString().split("T")[0];
      document.getElementById("datePickerText").textContent = today.toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" });
    });

    function getSelectedDoctorDate() {
      return document.getElementById('doctorDatePicker')?.value || new Date().toISOString().split('T')[0];
    }

    const originalFetchAndDisplayDoctors = fetchAndDisplayDoctors;
    fetchAndDisplayDoctors = function (date) {
      originalFetchAndDisplayDoctors(date || getSelectedDoctorDate());
    }
  </script>


  <script>
    const userName = localStorage.getItem("name");
    document.getElementById("userName").textContent = userName;
  </script>


<script>
  document.querySelector('#editModal button.bg-blue-600').addEventListener('click', async function () {
    const id = window.currentEditingAdminId;
    const name = document.getElementById("editName").value.trim();
    const email = document.getElementById("editEmail").value.trim();
    const contact = document.getElementById("editContact").value.trim();
const status = document.getElementById("editStatusDisplay").textContent.trim();


      if (!name || !email) {
        alert("Name and Email are required");
        return;
      }

      const token = localStorage.getItem("admin_jwt");
      if (!token) {
        alert("Unauthorized. Please login again.");
        return;
      }

      try {
        const res = await fetch(`/api/admin/updateAdmin/${id}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
          },
          body: JSON.stringify({
            username: name,
            email: email,
            phone: contact,
            status: status
          })
        });

        if (!res.ok) {
          const data = await res.json();
          throw new Error(data.message || "Failed to update admin");
        }

        alert("Admin updated successfully!");
        closeModals();
        fetchAdmins();
      } catch (err) {
        alert("Error: " + err.message);
      }
    });
  </script>

  <script>


    (function () {

      document.addEventListener("click", function (e) {
        if (e.target.classList.contains("view-profile-btn")) {
          e.preventDefault();
          const doctor = JSON.parse(e.target.getAttribute("data-doctor"));
          document.getElementById("profileDoctorName").textContent = doctor.name || "";
          document.getElementById("profileDoctorSpecialty").textContent = doctor.specialty || "";
          document.getElementById("profileDoctorExperience").textContent = doctor.experience || "";
          document.getElementById("profileDoctorQualification").textContent = doctor.qualification || "";
          document.getElementById("profileDoctorAvailability").textContent = doctor.availability || "";
          document.getElementById("profileDoctorAge").textContent = doctor.age || "";
          document.getElementById("profileDoctorGender").textContent = doctor.gender || "";
          document.getElementById("profileDoctorPhone").textContent = doctor.phone || "";
          document.getElementById("profileDoctorAddress").textContent = doctor.address || "";
          document.getElementById("viewDoctorProfileModalOverlay").classList.remove("hidden");
          const ageWrapper = document.getElementById('profileDoctorAgeWrapper');
          const ageElement = document.getElementById('profileDoctorAge');
          if (doctor.age) {
            ageElement.textContent = doctor.age;
            ageWrapper.classList.remove("hidden");
          } else {
            ageElement.textContent = '';
            ageWrapper.classList.add("hidden");
          }

          const genderWrapper = document.getElementById('profileDoctorGenderWrapper');
          const genderElement = document.getElementById('profileDoctorGender');
          if (doctor.gender) {
            genderElement.textContent = doctor.gender;
            genderWrapper.classList.remove("hidden");
          } else {
            genderElement.textContent = '';
            genderWrapper.classList.add("hidden");
          }

          const phoneWrapper = document.getElementById('profileDoctorPhoneWrapper');
          const phoneElement = document.getElementById('profileDoctorPhone');
          if (doctor.phone) {
            phoneElement.textContent = doctor.phone;
            phoneWrapper.classList.remove("hidden");
          } else {
            phoneElement.textContent = '';
            phoneWrapper.classList.add("hidden");
          }
          const addressWrapper = document.getElementById('profileDoctorAddressWrapper');
          const addressrElement = document.getElementById('profileDoctorAddress');
          if (doctor.address) {
            addressrElement.textContent = doctor.address;
            addressWrapper.classList.remove("hidden");
          } else {
            addressrElement.textContent = '';
            addressWrapper.classList.add("hidden");
          }
          document.body.classList.add("blurred-bg");
          e.target.closest(".action-menu").classList.add("hidden");
        }
      });
      document.getElementById("closeViewDoctorProfileBtn").onclick = function () {
        document.getElementById("viewDoctorProfileModalOverlay").classList.add("hidden");
        document.body.classList.remove("blurred-bg");
      };


      let currentDoctorForEditProfile = null;
      document.addEventListener("click", function (e) {
        if (e.target.classList.contains("edit-doctor-profile-btn")) {
          e.preventDefault();
          const doctor = JSON.parse(e.target.getAttribute("data-doctor"));
          currentDoctorForEditProfile = doctor;
          document.getElementById("editDoctorName").value = doctor.name || "";
          document.getElementById("editDoctorSpecialization").value = doctor.specialty || "";
          document.getElementById("editDoctorExperience").value = doctor.experience || "";
          document.getElementById("editDoctorQualification").value = doctor.qualification || "";
          document.getElementById("editDoctorAvailability").value = doctor.availability || "";
          document.getElementById("editDoctorAge").value = doctor.age || "";
          document.getElementById("editDoctorGender").value = doctor.gender || "";
          document.getElementById("editDoctorPhone").value = doctor.phone || "";
          document.getElementById("editDoctorAddress").value = doctor.address || "";
          document.getElementById("editDoctorProfileModalOverlay").classList.remove("hidden");
          document.body.classList.add("blurred-bg");
          e.target.closest(".action-menu").classList.add("hidden");
        }
      });
      document.getElementById("closeEditDoctorProfileModal").onclick = closeEditDoctorProfileModal;
      document.getElementById("cancelEditDoctorBtn").onclick = closeEditDoctorProfileModal;
      function closeEditDoctorProfileModal() {
        document.getElementById("editDoctorProfileModalOverlay").classList.add("hidden");
        document.body.classList.remove("blurred-bg");
        currentDoctorForEditProfile = null;
      }
      document.getElementById("editDoctorForm").onsubmit = async function (e) {
        e.preventDefault();
        if (!currentDoctorForEditProfile || !currentDoctorForEditProfile._id) {
          alert("No doctor selected for editing.");
          return;
        }
        const formData = new FormData();
        formData.append("name", document.getElementById("editDoctorName").value);
        formData.append("specialty", document.getElementById("editDoctorSpecialization").value);
        formData.append("experience", document.getElementById("editDoctorExperience").value);
        formData.append("qualification", document.getElementById("editDoctorQualification").value);
        formData.append("availability", document.getElementById("editDoctorAvailability").value);
        formData.append("age", document.getElementById("editDoctorAge").value);
        formData.append("gender", document.getElementById("editDoctorGender").value);
        formData.append("phone", document.getElementById("editDoctorPhone").value);
        formData.append("address", document.getElementById("editDoctorAddress").value);
        const photoInput = document.getElementById("editDoctorPhoto");
        if (photoInput.files && photoInput.files[0]) {
          formData.append("photo", photoInput.files[0]);
        }
        try {
          const response = await fetch(`/api/doctors/${currentDoctorForEditProfile._id}`, {
            method: "PUT",
            body: formData,
          });
          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.error || "Failed to update doctor");
          }
          closeEditDoctorProfileModal();
          await fetchAndDisplayDoctors(document.getElementById("datePicker").value);
          alert("Doctor profile updated successfully!");
        } catch (err) {
          alert("Error updating doctor: " + err.message);
        }
      };
      document.getElementById("editDoctorPhoto").addEventListener("change", function (event) {
        const file = event.target.files[0];
        const photoPreview = document.getElementById("editDoctorPhotoPreview");
        const defaultIcon = document.getElementById("editDoctorDefaultIcon");
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            photoPreview.src = e.target.result;
            photoPreview.style.display = "block";
            defaultIcon.style.display = "none";
          };
          reader.readAsDataURL(file);
        } else {
          photoPreview.src = "";
          photoPreview.style.display = "none";
          defaultIcon.style.display = "flex";
        }
      });


      let currentDoctorId = null;
      document.addEventListener("click", function (e) {
        if (e.target.classList.contains("manage-availability-btn")) {
          e.preventDefault();
          const doctor = JSON.parse(e.target.getAttribute("data-doctor"));
          currentDoctorId = doctor._id;
          document.getElementById("availabilityModalOverlay").classList.remove("hidden");
          document.body.classList.add("blurred-bg");
          document.getElementById("availabilityForm").reset();
          const today = new Date();
          document.getElementById("availabilityDate").value = today.toISOString().split("T")[0];
          fetchAndFillAvailabilityForDate(today.toISOString().split("T")[0]);
          e.target.closest(".action-menu").classList.add("hidden");
        }
      });
      document.getElementById("cancelAvailability").onclick = closeAvailabilityModal;
      document.getElementById("closeAvailabilityModal").onclick = closeAvailabilityModal;
      function closeAvailabilityModal() {
        document.getElementById("availabilityModalOverlay").classList.add("hidden");
        document.body.classList.remove("blurred-bg");
        currentDoctorId = null;
        document.getElementById("availabilityForm").reset();
      }
      flatpickr("#availabilityDate", {
        dateFormat: "Y-m-d",
        allowInput: false,
        static: true,
        onChange: function (selectedDates, dateStr) {
          fetchAndFillAvailabilityForDate(dateStr);
        },
      });
      flatpickr("#availabilityStart", {
        enableTime: true,
        noCalendar: true,
        dateFormat: "h:i K",
        time_24hr: false,
        allowInput: false,
        static: true,
      });
      flatpickr("#availabilityEnd", {
        enableTime: true,
        noCalendar: true,
        dateFormat: "h:i K",
        time_24hr: false,
        allowInput: false,
        static: true,
      });
      async function fetchAndFillAvailabilityForDate(dateStr) {
        if (!currentDoctorId) return;
        try {
          const res = await fetch(`/api/doctors/${currentDoctorId}/availability?date=${dateStr}`);
          if (res.ok) {
            const data = await res.json();
            document.getElementById("availabilityStart").value = data.start || "";
            document.getElementById("availabilityEnd").value = data.end || "";
          } else {
            document.getElementById("availabilityStart").value = "";
            document.getElementById("availabilityEnd").value = "";
          }
        } catch (err) {
          document.getElementById("availabilityStart").value = "";
          document.getElementById("availabilityEnd").value = "";
        }
      }
      document.getElementById("availabilityForm").onsubmit = async function (e) {
        e.preventDefault();
        const date = document.getElementById("availabilityDate").value;
        const start = document.getElementById("availabilityStart").value;
        const end = document.getElementById("availabilityEnd").value;
        if (!currentDoctorId) return;
        try {
          const response = await fetch(`/api/doctors/${currentDoctorId}/availability`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ date, start, end }),
          });
          if (!response.ok) throw new Error("Failed to save availability");
          closeAvailabilityModal();
          await fetchAndDisplayDoctors(document.getElementById("datePicker").value);
        } catch (err) {
          alert("Error saving availability: " + err.message);
        }
      };
    })();
    (function () {
      document.addEventListener("click", function (e) {
        if (e.target.classList.contains("action-btn")) {
          e.stopPropagation();
          document.querySelectorAll(".action-menu").forEach(menu => menu.classList.add("hidden"));
          const menu = e.target.nextElementSibling;
          if (menu) menu.classList.toggle("hidden");
        } else {
          document.querySelectorAll(".action-menu").forEach(menu => menu.classList.add("hidden"));
        }
      });
    })();
    (function () {
      const addDoctorBtn = document.getElementById("addDoctorBtn");
      const addDoctorModalOverlay = document.getElementById("addDoctorModalOverlay");
      if (addDoctorModalOverlay) {
        const closeAddDoctorModal = document.getElementById("closeAddDoctorModal");
        const openModal = () => {
          addDoctorModalOverlay.classList.remove("hidden");
          document.body.classList.add("blurred-bg");
        };
        const closeModal = () => {
          addDoctorModalOverlay.classList.add("hidden");
          document.body.classList.remove("blurred-bg");
          const form = document.getElementById("addDoctorForm");
          if (form) form.reset();
          showDoctorError("");
        };
        if (addDoctorBtn) {
          addDoctorBtn.addEventListener("click", openModal);
        }
        if (closeAddDoctorModal) {
          closeAddDoctorModal.addEventListener("click", closeModal);
        }
        const addDoctorForm = document.getElementById("addDoctorForm");
        if (addDoctorForm) {
          addDoctorForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(addDoctorForm);
            const firstName = formData.get("firstName")?.trim() || "";
            const lastName = formData.get("lastName")?.trim() || "";
            const fullName = `Dr. ${firstName} ${lastName}`.replace(/\s+/g, " ").trim().toLowerCase();
            try {
              const res = await fetch("/api/doctors");
              const existingDoctors = await res.json();
              const isDuplicate = existingDoctors.some((doc) => {
                const existingName = (doc.name || "").replace(/\s+/g, " ").trim().toLowerCase();
                return existingName === fullName;
              });
              if (isDuplicate) {
                showDoctorError("Doctor already exists: duplicate name.");
                return;
              }
            } catch (err) {
              showDoctorError("Error checking existing doctors.");
              return;
            }
            const doctorData = {
              firstName,
              lastName,
              name: `Dr. ${firstName} ${lastName}`,
              specialty: formData.get("specialty"),
              experience: formData.get("experience"),
              qualification: formData.get("qualification"),
              availability: formData.get("availability"),
            };
            try {
              const response = await fetch("/api/doctors", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(doctorData),
              });
              if (!response.ok) {
                const errorData = await response.json();
                showDoctorError(errorData.error || "Failed to add doctor.");
                return;
              }
              showDoctorError("");
              alert("Doctor added successfully!");
              closeModal();
              await fetchAndDisplayDoctors();
            } catch (error) {
              showDoctorError("Error adding doctor: " + (error.message || "Unknown error"));
            }
          });
        }
      }
      function showDoctorError(msg) {
        const errorDiv = document.getElementById("doctorErrorMsg");
        if (!errorDiv) return;
        if (msg) {
          errorDiv.textContent = msg;
          errorDiv.style.display = "block";
        } else {
          errorDiv.textContent = "";
          errorDiv.style.display = "none";
        }
      }
    })();
  </script>

  <script>
    const dropdownToggle = document.getElementById("userDropdownToggle");
    const dropdownMenu = document.getElementById("userDropdownMenu");

    dropdownToggle.addEventListener("click", () => {
      dropdownMenu.classList.toggle("hidden");
    });

    document.addEventListener("click", (event) => {
      if (!dropdownToggle.contains(event.target) && !dropdownMenu.contains(event.target)) {
        dropdownMenu.classList.add("hidden");
      }
    });
  </script>
  <script>
    async function logout() {
          try {
            const token = localStorage.getItem('admin_jwt');
            const res = await fetch("/api/admin/logout", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ token }),
            });
            const result = await res.json();
            if (res.ok) {
              localStorage.clear();
              window.location.href = "login.html";
            } else {
              alert(result.error);
            }
          } catch (err) {
            alert("Error: " + err.message);
          }
      };
  </script>

</body>

</html>