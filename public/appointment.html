<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Appointment - MediCare</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .form-section {
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 1.5rem auto;
            max-width: 800px;
        }

        .form-section h2 {
            color: #4a6fa5;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #343a40;
        }

        .form-group input,
        .form-group select {
            padding: 0.75rem;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #66b3ff;
            box-shadow: 0 0 0 3px rgba(102, 179, 255, 0.2);
        }

        .calendar-day:hover {
            background-color: #e5e7eb;
            cursor: pointer;
        }

        .calendar-day.selected {
            background-color: #3b82f6;
            color: white;
        }

        .time-slot {
            transition: all 0.2s ease;
            position: relative;
            height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .time-slot:hover:not(.unavailable) {
            background-color: #e5e7eb;
        }

        .time-slot.selected {
            background-color: #3b82f6;
            color: white;
        }

        .time-slot.unavailable {
            color: #dc2626;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .time-slot[data-tooltip]:hover:before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 4px 8px;
            background-color: #374151;
            color: white;
            font-size: 12px;
            border-radius: 4px;
            white-space: nowrap;
            z-index: 10;
        }

        .time-slot[data-tooltip]:hover:after {
            content: "";
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 4px;
            border-style: solid;
            border-color: #374151 transparent transparent transparent;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);

            display: none;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        .alert-box {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .blurred-bg>*:not(#availabilityModalOverlay):not(#viewDetailsModalOverlay) {
            filter: blur(4px) !important;
            pointer-events: none;
            user-select: none;
        }

        #toast { z-index: 9999; }

    
@media (max-width: 640px) {
  
  .navbar {
    flex-direction: column;
    align-items: flex-start;
    padding: 10px;
  }
  .navbar button {
    margin-top: 10px;
    width: 100%;
  }

  
  #stepperContainer {
    flex-direction: column;
    gap: 1rem;
  }

  
  .form-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
  }


  #doctorSection input,
  #doctorSection select {
    width: 100% !important;
    margin-bottom: 10px;
  }

 
  #dateTimeSection .grid {
    grid-template-columns: 1fr;
  }
}


@media (min-width: 641px) and (max-width: 1024px) {
  .form-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  #dateTimeSection .grid {
    grid-template-columns: 1fr 1fr;
  }
}


@media (min-width: 1025px) {
  .form-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}
    </style>
    <style>
      
body.dark {
  background: #181928;
  color: #dee4ef;
}body.dark .bg-white, body.dark .shadow, body.dark .shadow-md, body.dark .shadow-lg {
  background: #23243a !important;
  color: #eaeaff !important;
  box-shadow: 0 4px 20px rgba(0,0,0,0.4) !important;
}
body.dark .form-section, .form-section {
  background: #fff;
  color: #23243a;
}
body.dark .form-section {
  background: #23243a !important;
  color: #f3f4f6 !important;
}
body.dark .form-section label,
body.dark .form-section .text-gray-800 {
  color: #fff !important;
}
body.dark .form-section .text-gray-600,
body.dark .form-section .text-gray-500 {
  color: #b3bed7 !important;
}
body.dark .bg-gray-50 {
  background: #2c2d44 !important;
  color: #e5e7eb !important;
}
body.dark .border-gray-300 {
  border-color: #383a53 !important;
}
body.dark input, body.dark select, body.dark textarea {
  background: #23243a;
  color: #fff;
  border-color: #3f415f !important;
}
body.dark input:focus, body.dark select:focus {
  border-color: #67cbfc !important;
  box-shadow: 0 0 0 3px rgba(102,179,255,0.10);
}
body.dark ::placeholder {
  color: #a1aacd;
}
body.accent-pink .form-section h2 { color: #160a56 !important; }
body.accent-pink .form-section h2 { color: #db2777 !important; }
body.accent-orange .form-section h2 { color: #ea580c !important; }
body.accent-purple .form-section h2 { color: #8b5cf6 !important; }
body.accent-teal .form-section h2   { color: #06b6d4 !important; }
body.accent-green .form-section h2  { color: #16a34a !important; }
body.accent-brown .form-section h2  { color: #a16207 !important; }
.form-section button:not(:disabled),
button.accent-btn:not(:disabled),
#confirmBookingBtn:not(:disabled),
#dateTimeNextBtn:not(:disabled),
#doctorNextBtn:not(:disabled),
#patientNextBtn:not(:disabled),
#skipReferralBtn:not(:disabled),
#referralNextBtn:not(:disabled) {
  background: #2563eb; 
  color: #fff;
  border: none;
  transition: background 0.2s;
}
.form-section button:disabled,
#confirmBookingBtn:disabled, #dateTimeNextBtn:disabled, #doctorNextBtn:disabled,
#patientNextBtn:disabled, #referralNextBtn:disabled {
  background: #a3a3a3 !important; cursor:not-allowed; color:#f3f4f6 !important; opacity:0.6;
}
body.accent-pink .form-section button, body.accent-pink #confirmBookingBtn, body.accent-pink #patientNextBtn, body.accent-pink #dateTimeNextBtn, body.accent-pink #doctorNextBtn, body.accent-pink #skipReferralBtn, body.accent-pink #referralNextBtn {
  background: #db2777 !important;
}
body.accent-pink .form-section button:hover { background: #be185d !important; }
body.accent-orange .form-section button, body.accent-orange #confirmBookingBtn, body.accent-orange #patientNextBtn, body.accent-orange #dateTimeNextBtn, body.accent-orange #doctorNextBtn, body.accent-orange #skipReferralBtn, body.accent-orange #referralNextBtn {
  background: #ea580c !important;
}
body.accent-orange .form-section button:hover { background: #c2410c !important; }
body.accent-purple .form-section button, body.accent-purple #confirmBookingBtn, body.accent-purple #patientNextBtn, body.accent-purple #dateTimeNextBtn, body.accent-purple #doctorNextBtn, body.accent-purple #skipReferralBtn, body.accent-purple #referralNextBtn {
  background: #8b5cf6 !important;
}
body.accent-purple .form-section button:hover { background: #6d28d9 !important; }
body.accent-teal .form-section button, body.accent-teal #confirmBookingBtn, body.accent-teal #patientNextBtn, body.accent-teal #dateTimeNextBtn, body.accent-teal #doctorNextBtn, body.accent-teal #skipReferralBtn, body.accent-teal #referralNextBtn {
  background: #06b6d4 !important;
}
body.accent-teal .form-section button:hover { background: #0e7490 !important; }
body.accent-green .form-section button, body.accent-green #confirmBookingBtn, body.accent-green #patientNextBtn, body.accent-green #dateTimeNextBtn, body.accent-green #doctorNextBtn, body.accent-green #skipReferralBtn, body.accent-green #referralNextBtn {
  background: #16a34a !important;
}
body.accent-green .form-section button:hover { background: #15803d !important; }
body.accent-brown .form-section button, body.accent-brown #confirmBookingBtn, body.accent-brown #patientNextBtn, body.accent-brown #dateTimeNextBtn, body.accent-brown #doctorNextBtn, body.accent-brown #skipReferralBtn, body.accent-brown #referralNextBtn {
  background: #a16207 !important;
}
body.accent-brown .form-section button:hover { background: #713f12 !important; }
#stepperContainer .border-blue-600,
#stepperContainer .text-blue-600 {
  border-color: #2563eb !important;
  color: #2563eb !important;
}
body.accent-pink #stepperContainer .border-blue-600,
body.accent-pink #stepperContainer .text-blue-600 {
  border-color: #db2777 !important; color: #db2777 !important;
}
body.accent-orange #stepperContainer .border-blue-600,
body.accent-orange #stepperContainer .text-blue-600 {
  border-color: #ea580c !important; color: #ea580c !important;
}
body.accent-purple #stepperContainer .border-blue-600,
body.accent-purple #stepperContainer .text-blue-600 {
  border-color: #8b5cf6 !important; color: #8b5cf6 !important;
}
body.accent-teal #stepperContainer .border-blue-600,
body.accent-teal #stepperContainer .text-blue-600 {
  border-color: #06b6d4 !important; color: #06b6d4 !important;
}
body.accent-green #stepperContainer .border-blue-600,
body.accent-green #stepperContainer .text-blue-600 {
  border-color: #16a34a !important; color: #16a34a !important;
}
body.accent-brown #stepperContainer .border-blue-600,
body.accent-brown #stepperContainer .text-blue-600 {
  border-color: #4c2e04 !important; color: #4c2e04 !important;
}
#stepperContainer .text-blue-600:empty,
#stepperContainer .text-blue-600:not(:empty) {
  background: transparent !important;
}
#stepperContainer .text-blue-600::after {
  content: none !important;
}
#stepperContainer p.text-blue-600, #stepperContainer p.text-gray-400 {
  color: #6b7280 !important;
}


#stepperContainer .bg-blue-600 {
  background: #fff !important;
}
body.dark #stepperContainer .bg-blue-600 {
  background: #23243a !important;
}


body.dark #confirmationSection .bg-white, body.dark #confirmationSection .bg-gray-50,
body.dark #confirmationSection .text-gray-800, 
body.dark #confirmationSection .text-gray-500, 
body.dark #confirmationSection .text-gray-600 {
  color: #ffffff !important;
  background:#23243a !important;
}
body.dark #confirmationSection span {
  color: #fff !important;
}

body.dark select:disabled, body.dark input:disabled {
  color: #b2bacf !important;
  background: #23243a !important;
  opacity:0.7;
}
.form-section button, .form-section button:focus, .form-section button:hover {
  filter: none !important;
  outline: none !important;
}

#stepperContainer .stepper-line {
  background: #fff !important; 
  transition: background 0.3s;
}


body.dark #stepperContainer .stepper-line {
  background: #fff !important;
}


#stepperContainer .stepper-line.filled {
  background: #ea580c !important; 
}


body.accent-pink #stepperContainer .stepper-line.filled { background: #475db2 !important; }
body.accent-pink #stepperContainer .stepper-line.filled { background: #db2777 !important; }
body.accent-purple #stepperContainer .stepper-line.filled { background: #8b5cf6 !important; }
body.accent-teal   #stepperContainer .stepper-line.filled { background: #06b6d4 !important; }
body.accent-green  #stepperContainer .stepper-line.filled { background: #16a34a !important; }
body.accent-brown  #stepperContainer .stepper-line.filled { background: #a16207 !important; }


#stepperContainer .stepper-circle.active,
#stepperContainer .stepper-circle.completed {
  border-color: #ea580c !important;
  color: #ea580c !important;
}
body.dark #pageTitle, 
body.dark .form-section h2, 
body.dark .text-gray-800 {
  color: #fff !important;
}
body.accent-green .select-btn.bg-blue-500,
body.accent-green .select-btn.hover\:bg-blue-600 {
  background: #16a34a !important;
}
body.accent-orange .select-btn.bg-blue-500,
body.accent-orange .select-btn.hover\:bg-blue-600 {
  background: #ea580c !important;
}
body.accent-purple .select-btn.bg-blue-500,
body.accent-purple .select-btn.hover\:bg-blue-600 {
  background: #8b5cf6 !important;
}
body.accent-pink .select-btn.bg-blue-500,
body.accent-pink .select-btn.hover\:bg-blue-600 {
  background: #db2777 !important;
}
body.accent-teal .select-btn.bg-blue-500,
body.accent-teal .select-btn.hover\:bg-blue-600 {
  background: #06b6d4 !important;
}
body.accent-brown .select-btn.bg-blue-500,
body.accent-brown .select-btn.hover\:bg-blue-600 {
  background: #a16207 !important;
}
body.dark #alertMessage,
body.dark .alert-box #alertMessage {
  color: #fff !important;
}


body.dark.accent-pink .form-section h2  { color: #db2777 !important; }
body.dark.accent-orange .form-section h2 { color: #ea580c !important; }
body.dark.accent-purple .form-section h2 { color: #8b5cf6 !important; }
body.dark.accent-teal .form-section h2   { color: #06b6d4 !important; }
body.dark.accent-green .form-section h2  { color: #16a34a !important; }
body.dark.accent-brown .form-section h2  { color: #a16207 !important; }
body.dark.accent-pink .section h2  { color: #db2777 !important; }
body.dark.accent-orange .section h2 { color: #ea580c !important; }
body.dark.accent-purple .section h2 { color: #8b5cf6 !important; }
body.dark.accent-teal .section h2   { color: #06b6d4 !important; }
body.dark.accent-green .section h2  { color: #16a34a !important; }
body.dark.accent-brown .section h2  { color: #a16207 !important; }


.accent-link {
  color: #1f2937;
  transition: color .15s ease;
}

.accent-link:hover {
  opacity: 0.9;
  text-decoration: none;
}


body.accent-blue .accent-link { color: #3b82f6 !important; }
body.accent-green .accent-link { color: #10b981 !important; }
body.accent-brown .accent-link { color: #b55656 !important; }
body.accent-purple .accent-link { color: #8b5cf6 !important; }
body.accent-orange .accent-link { color: #f59e0b !important; }
body.accent-pink .accent-link { color: #ec4899 !important; }
body.accent-teal .accent-link { color: #14b8a6 !important; }


body.dark.accent-blue .accent-link,
body.dark .accent-link.accent-blue { color: #3b82f6 !important; }

body.dark.accent-green .accent-link { color: #10b981 !important; }
body.dark.accent-brown .accent-link { color: #b55656 !important; }
body.dark.accent-purple .accent-link { color: #8b5cf6 !important; }
body.dark.accent-orange .accent-link { color: #f59e0b !important; }
body.dark.accent-pink .accent-link { color: #ec4899 !important; }
body.dark.accent-teal .accent-link { color: #14b8a6 !important; }

body.dark .accent-link { color: #fbfbfb !important; }








.accent-link {
  color: #1f2937; 
  background-color: transparent; 
  padding: 0.25rem 0.5rem; 
  border-radius: 0.375rem; 
  transition: all 0.15s ease;
  text-decoration: none;
}


.accent-link:hover {
  opacity: 0.9;
  text-decoration: none;
}


body.accent-blue .accent-link,
body.dark.accent-blue .accent-link {
  color: #ffffff !important;
  background-color: #3b82f6 !important;
}

body.accent-green .accent-link,
body.dark.accent-green .accent-link {
  color: #ffffff !important;
  background-color: #10b981 !important;
}

body.accent-brown .accent-link,
body.dark.accent-brown .accent-link {
  color: #ffffff !important;
  background-color: #b55656 !important;
}

body.accent-purple .accent-link,
body.dark.accent-purple .accent-link {
  color: #ffffff !important;
  background-color: #8b5cf6 !important;
}

body.accent-orange .accent-link,
body.dark.accent-orange .accent-link {
  color: #ffffff !important;
  background-color: #f59e0b !important;
}

body.accent-pink .accent-link,
body.dark.accent-pink .accent-link {
  color: #ffffff !important;
  background-color: #ec4899 !important;
}

body.accent-teal .accent-link,
body.dark.accent-teal .accent-link {
  color: #ffffff !important;
  background-color: #14b8a6 !important;
}

  .step-line {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    height: 2px;
    background-color: #e5e7eb; 
    z-index: 0;
    left: calc(50% + 20px);  
    right: -40%;            
  }
  .stepper-circle {
    width: 40px;
    height: 40px;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid #9ca3af; 
    background-color: #f1f7f88c; 
    color: #d1d5db;            
    z-index: 10;
    margin: 0 auto;
  }
  .stepper-text {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: #9ca3af; 
  }
  








body.dark .calendar-day {
  background-color: transparent !important;
  color: #fff !important; 
}


body.dark .calendar-day.bg-green-100,
body.dark .calendar-day.available {
  background-color: #bbf7d0 !important; 
  color: #000 !important; 
  border: 2px solid #22c55e !important; 
}


body.dark .calendar-day.bg-green-100:hover,
body.dark .calendar-day.available:hover {
  background-color: #22c55e !important; 
  color: #fff !important; 
  border: 2px solid #15803d !important; 
}


body.dark .calendar-day.selected {
  background-color: #16a34a !important;
  color: #fff !important;
  border: 2px solid #065f46 !important; 
}

@media print {
  .confirmation-actions {
    display: none !important;
  }
}




 </style>
</head>

<body class="bg-blue-50 font-sans">
    <div id="toast-container" class="fixed bottom-4 right-0 transform -translate-x-1/2 z-50 space-y-3"></div>
    <div id="overlay" class="overlay">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4">
                    <svg class="h-10 w-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>

                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4" id="alertMessage">Appointment booked successfully!
                </h3>

              <a href="admindasboard.html" button onclick="hideAlert()"
                    class="w-full inline-flex justify-center px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm transition-colors duration-200">
                    OK
                </button></a>
            </div>
        </div>
    </div>
    <div id="toast" class="fixed top-6 right-6 z-50 hidden px-6 py-3 rounded-lg font-semibold text-white bg-green-600 shadow-lg transition-all"></div>
<div class="p-3 flex justify-between items-center bg-white shadow">
 
  <div class="flex items-center ml-24">
    <img id="orgLogo" class="w-8 h-8 mr-2" alt="Logo">
    <h1 id="orgName" class="text-xl font-bold text-blue-600">MediCare</h1>
  </div>


  <button onclick="window.location.href='admindasboard.html'"
  class="accent-link flex items-center gap-2">
  <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">

  </svg>
  <span>Back to Dashboard</span>
</button>
</div>

    <div class="max-w-4xl mx-auto mt-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6" id="pageTitle">Book an Appointment</h2>
    </div>

    <div class="max-w-6xl mx-auto mt-8" id="stepperContainer">
  <div class="flex items-center justify-between relative">

 
    <div class="flex-1 text-center relative">
      <div class="relative flex items-center justify-center">
        <div class="stepper-circle" id="step1">1</div>
        <div class="step-line"></div>
      </div>
      <p class="stepper-text" id="step1Text">Patient Details</p>
    </div>


    <div class="flex-1 text-center relative">
      <div class="relative flex items-center justify-center">
        <div class="stepper-circle" id="step2">2</div>
        <div class="step-line"></div>
      </div>
      <p class="stepper-text" id="step2Text">Select Doctor</p>
    </div>

 
    <div class="flex-1 text-center relative">
      <div class="relative flex items-center justify-center">
        <div class="stepper-circle" id="step3">3</div>
        <div class="step-line"></div>
      </div>
      <p class="stepper-text" id="step3Text">Date & Time</p>
    </div>


    <div class="flex-1 text-center relative">
      <div class="relative flex items-center justify-center">
        <div class="stepper-circle" id="step4">4</div>
        <div class="step-line"></div>
      </div>
      <p class="stepper-text" id="step4Text">Referral</p>
    </div>

   
    <div class="flex-1 text-center relative">
      <div class="relative flex items-center justify-center">
        <div class="stepper-circle" id="step5">5</div>
      </div>
      <p class="stepper-text" id="step5Text">Confirmation</p>
    </div>

  </div>
</div>


    <section id="patientSection" class="section active">
        <div class="form-section">
            <h2>Patient Details</h2>
            <form id="patientForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="patient-name">Patient Name<span class="text-red-500">*</span></label>
                        <div id="patient-name-error" class="text-red-500 text-sm mt-1"></div>
                        <input type="text" id="patient-name" name="name" placeholder="Enter full name" required
                            title="Enter name using only letters and spaces" maxlength="50" />
                    </div>

                   <div class="form-group">
  <label for="age">Age<span class="text-red-500">*</span></label>
<select id="age" name="age" required>
  <option value="">Select Age</option>
  <option value="0.25">Below 1 year</option>

  <option value="1">1 year</option>
  <option value="2">2 years</option>
  <option value="3">3 years</option>
  <option value="4">4 years</option>
  <option value="5">5 years</option>
  <option value="6">6 years</option>
  <option value="7">7 years</option>
  <option value="8">8 years</option>
  <option value="9">9 years</option>
  <option value="10">10 years</option>
  <option value="show_more">Show More...</option>
</select>

</div>

                    <div class="form-group">
                        <label for="patient-gender">Gender<span class="text-red-500">*</span></label>
                        <select id="patient-gender" name="gender" required>
                            <option value="">Select</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="blood-group">Blood Group<span class="text-red-500">*</span></label>
                        <select id="blood-group" name="blood" required>
                            <option value="">Select</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="contact-number">Contact Number<span class="text-red-500">*</span></label>
                        <input type="tel" id="contact-number" name="contact" placeholder="Enter 10-digit number"
                            pattern="^[6-9][0-9]{9}$" inputmode="numeric" maxlength="10" required
                            title="Please enter a valid 10-digit Indian mobile number starting with 6, 7, 8, or 9"
                            autocomplete="off" />
                    </div>
                    <div class="form-group">
                        <label for="symptoms">Symptoms</label>
                        <input type="text" id="symptoms" name="symptoms" placeholder="Enter symptoms" />
                    </div>

                </div>
                <div class="text-right mt-6">
                    <button type="button" id="patientNextBtn"
                        class="bg-gray-400 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">Next</button>
                </div>
            </form>
        </div>
    </section>

    <section id="doctorSection" class="section">
        <div class="max-w-4xl mx-auto bg-white p-6 mt-8 rounded shadow">
            <h2 class="text-xl font-semibold mb-4">Select a Doctor</h2>

            <div class="flex justify-between items-center mb-6">
                <input type="text" id="searchInput" placeholder="Search doctors or specialties..."
                    class="w-2/3 p-2 border rounded-md" onkeyup="filterDoctors()" />
                <select id="specialtyFilter" class="p-2 border rounded-md" onchange="filterDoctors()"></select>
            </div>

            <div id="doctorList" class="space-y-4"></div>
            <div id="pagination" class="flex justify-between items-center mt-6">
                <button onclick="goBack()" class="bg-gray-500 text-white px-6 py-2 rounded bg-gray-600"
                    id="doctorBackBtn">Back</button>

                <div class="flex items-center space-x-4">
                    <button onclick="prevPage()" id="prevBtn"
                        class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-300 text-gray-600 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <span id="pageInfo" class="text-sm text-gray-600 font-medium"></span>
                    <button onclick="nextPage()" id="nextBtn"
                        class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-300 text-gray-600 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>

                <button id="doctorNextBtn" onclick="handleDoctorNext()"
                    class="bg-gray-400 text-white px-6 py-2 rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled>
                    Next
                </button>
            </div>
        </div>
    </section>

    <section id="dateTimeSection" class="section">
        <div class="max-w-4xl mx-auto bg-white p-6 mt-8 rounded shadow">
            <h2 class="text-xl font-semibold mb-4">Choose Date & Time</h2>
            <p class="text-gray-600 mb-6">Select your preferred appointment date and time</p>

            <div class="grid grid-cols-2 gap-8">
                <div class="border rounded-lg p-4">
                    <div class="flex justify-between items-center mb-4">
                        <button type="button" onclick="changeMonth(-1)"
                            class="px-3 py-1 text-gray-600 hover:bg-gray-100 rounded-md transition-colors duration-200 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <h3 id="monthLabel" class="text-lg font-medium"></h3>
                        <button type="button" onclick="changeMonth(1)"
                            class="px-3 py-1 text-gray-600 hover:bg-gray-100 rounded-md transition-colors duration-200 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>

                    <div class="grid grid-cols-7 gap-1">
                        <div id="dayNames" class="col-span-7 grid grid-cols-7 text-center text-sm text-gray-600 mb-2">
                        </div>
                        <div id="daysContainer" class="col-span-7 grid grid-cols-7 gap-1"></div>
                    </div>

                    <div class="mt-4 flex items-center text-sm text-gray-600">
                        <span class="flex items-center mr-4">
                            <span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span>
                            Available
                        </span>
                        <span class="flex items-center">
                            <span class="w-3 h-3 rounded-full bg-red-100 mr-2"></span>
                            Unavailable
                        </span>
                    </div>
                </div>

                <div>
                    <div id="noTime"
                        class="flex flex-col items-center justify-center h-64 text-gray-500 border rounded-lg p-4">
                        <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <p class="text-center">Please select a date from the calendar to view available time slots</p>
                    </div>
                    <div id="loadingTime"
                        class="hidden flex flex-col items-center justify-center h-64 text-gray-500 border rounded-lg p-4">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mb-4"></div>
                        <p class="text-center">Loading available time slots...</p>
                    </div>
                    <div id="timeSlots" class="border rounded-lg p-4 hidden">
                        <div class="flex justify-between items-center mb-4 border-b pb-3">
                            <h4 class="font-medium text-lg text-gray-800">Select Time</h4>
                        </div>
                        <div class="grid grid-cols-3 gap-4 p-2"></div>
                    </div>
                </div>
            </div>

            <div class="flex justify-between mt-8">
                <button onclick="goBackToDoctor()"
                    class="px-6 py-2 border border-gray-300 rounded-lg text-white bg-gray-600">Back</button>
                <button id="dateTimeNextBtn" onclick="goToReferral()" disabled
                    class="px-6 py-2 bg-gray-400 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed">
                    Next
                </button>
            </div>
        </div>
    </section>

    <section id="referralSection" class="section">
        <div class="max-w-4xl mx-auto bg-white p-6 mt-8 rounded shadow">
            <h2 class="text-xl font-semibold mb-4">Referral Information</h2>
            <p class="text-gray-600 mb-6">If you were referred by a doctor, please provide their name. Otherwise, you can skip this step.</p>

            <div class="form-group mb-6">
                <label for="referred-by">Referred By (Doctor Name)</label>
                <div class="flex gap-2">
                    <input type="text" id="referred-by" name="referral"
                        placeholder="Enter doctor's name (optional)"
                        class="flex-1 p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        oninput="checkReferralForm()">
                    <button type="button" onclick="clearReferralField()"
                        class="px-3 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors duration-200">
                        Clear
                    </button>
                </div>
                <div id="referral-error" class="text-red-500 text-sm mt-1 hidden"></div>
            </div>

            <div class="flex justify-between">
                <button onclick="goBackToDateTime()"
                    class="px-6 py-2 border border-gray-300 rounded-lg text-white bg-gray-600">
                    Back
                </button>
<div class="flex gap-4">
                <button type="button" id="skipReferralBtn" onclick="skipReferral()"
    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:opacity-50">
    Skip
</button>

                    <button type="button" id="referralNextBtn" onclick="goToConfirmationFromReferral()"
                        class="px-6 py-2 bg-gray-400 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
                        disabled>
                        Next
                    </button>
                </div>
            </div>
        </div>
    </section>

    <section id="confirmationSection" class="section">
        <div class="max-w-4xl mx-auto mt-8">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-2">Confirm Your Appointment</h2>
                <p class="text-gray-500 text-sm mb-6">Please review your appointment details before confirming.</p>
                <div class="grid grid-cols-1 gap-4 mb-4">
                    <div class="border rounded-lg p-4 bg-gray-50 mb-2">
                        <p class="text-gray-800 font-semibold text-lg mb-2">Doctor Information</p>
                        <div class="space-y-2">
                            <div><span class="text-gray-500">Name:</span> <span class="text-gray-800 ml-1"
                                    id="confirmDoctor"></span></div>
                            <div><span class="text-gray-500">Specialty:</span> <span class="text-gray-800 ml-1"
                                    id="confirmSpecialty"></span></div>
                            <div><span class="text-gray-500">Experience:</span> <span class="text-gray-800 ml-1"
                                    id="confirmExperience"></span> years</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="border rounded-lg p-4 bg-gray-50">
                            <p class="text-gray-800 font-semibold text-lg mb-2">Date</p>
                            <span class="text-gray-800" id="confirmDate"></span>
                        </div>
                        <div class="border rounded-lg p-4 bg-gray-50">
                            <p class="text-gray-800 font-semibold text-lg mb-2">Time</p>
                            <span class="text-gray-800" id="confirmTime"></span>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="border rounded-lg p-4 bg-gray-50">
                            <p class="text-gray-800 font-semibold text-lg mb-2">Personal Details</p>
                            <div class="space-y-2">
                                <div><span class="text-gray-500">Name:</span> <span class="text-gray-800 ml-1"
                                        id="confirmPatientName"></span></div>
                                <div><span class="text-gray-500">Age:</span> <span class="text-gray-800 ml-1"
                                        id="confirmPatientAge"></span></div>
                            </div>
                        </div>
                        <div class="border rounded-lg p-4 bg-gray-50">
                            <div class="space-y-2 mt-8">
                                <div><span class="text-gray-500">Blood Group:</span> <span class="text-gray-800 ml-1"
                                        id="confirmPatientBlood"></span></div>
                                <div><span class="text-gray-500">Gender:</span> <span class="text-gray-800 ml-1"
                                        id="confirmPatientGender"></span></div>
                                        <div>
                                     <span class="text-gray-500">Symptoms:</span> 
                                     <span class="text-gray-800 ml-1" id="confirmPatientSymptoms"></span>
                                       </div>
                            </div>
                        </div>
                    </div>
                    <div class="border rounded-lg p-4 bg-gray-50 mt-2">
                        <p class="text-gray-800 font-semibold text-lg mb-2">Contact Information</p>
                        <div><span class="text-gray-500">Phone:</span> <span class="text-gray-800 ml-1"
                                id="confirmPatientContact"></span></div>
                    </div>
                    <div id="referralInfo" class="border rounded-lg p-4 bg-gray-50 mt-2 hidden">
                        <p class="text-gray-800 font-semibold text-lg mb-2">Referral Information</p>
                        <div><span class="text-gray-500">Referred By:</span> <span class="text-gray-800 ml-1"
                                id="confirmReferral"></span></div>
                    </div>
                </div>
<div class="flex justify-between mt-6 confirmation-actions">
  <button onclick="goBackToReferral()" 
          class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200 confirmation-action">
    Back
  </button>
   <button id="printBtn" 
          class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors confirmation-action">
    Print
  </button>
  <button onclick="confirmBooking()" id="confirmBookingBtn"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 confirmation-action">
    Confirm Appointment
  </button>
 
</div>

            </div>
        </div>
    </section>

    <script>
   document.getElementById("age").addEventListener("change", function() {
  if (this.value === "show_more") {
    
    this.innerHTML = `<option value="">Select Age</option>
      <option value="0.25">Below 1 year</option>`;
    for (let i = 1; i <= 100; i++) {
      this.innerHTML += `<option value="${i}">${i} year${i > 1 ? "s" : ""}</option>`;
    }
    this.innerHTML += `<option value="100+">Above 100 years</option>`;
    this.size = 1; 
    this.focus();
  }



            updateStepper(1);

        
            const referralInput = document.getElementById("referred-by");
            if (referralInput) {
                referralInput.addEventListener("input", checkReferralForm);
                checkReferralForm(); 
            }

            const inputs = document.querySelectorAll("#patientForm input, #patientForm select");
            inputs.forEach((input) => {
                input.addEventListener("input", checkPatientForm);
                input.addEventListener("change", checkPatientForm);
            });
            const nameInput = document.getElementById("patient-name");
            nameInput.addEventListener("input", function () {
                let value = this.value;
                value = value.replace(/[^A-Za-z.\s]/g, "");
                value = value.replace(/\s{2,}/g, " ");
                value = value.replace(/\.{2,}/g, ".");
                value = value.replace(/^[.\s]+/, "");

                this.value = value;

                validateNameInput();
                checkPatientForm();
            });
            nameInput.addEventListener("blur", validateNameInput);
            function validateNameInput() {
                const errorDiv = document.getElementById("patient-name-error");
                const name = nameInput.value.trim();
                const nameRegex = /^[A-Za-z]+([ .][A-Za-z]+)*$/;

                if (!nameRegex.test(name)) {
                    nameInput.classList.add("border-red-500");
                    if (!errorDiv) {
                        const newError = document.createElement("div");
                        newError.id = "patient-name-error";
                        newError.className = "text-red-500 text-sm mt-1";
                        newError.textContent = "Please enter a valid name (letters, dot, space allowed after letters)";
                        nameInput.parentNode.appendChild(newError);
                    } else {
                        errorDiv.textContent = "Please enter a valid name (letters, dot, space allowed after letters)";
                    }
                } else {
                    nameInput.classList.remove("border-red-500");
                    if (errorDiv) errorDiv.remove();
                }
            }

            nameInput.addEventListener("paste", function (e) {
                e.preventDefault();
                const text = (e.originalEvent || e).clipboardData.getData("text/plain");
                const cleanedText = text
                    .replace(/[^A-Za-z.\s]/g, "")
                    .replace(/\s{2,}/g, " ")
                    .replace(/\.{2,}/g, ".")
                    .replace(/^[.\s]+/, "")
                    .trim();

                this.value = cleanedText;
                validateNameInput();
                checkPatientForm();
            });

            const contactInput = document.getElementById("contact-number");
            contactInput.addEventListener("keypress", function (e) {
                const char = String.fromCharCode(e.keyCode || e.which);
                if (!/^[0-9]$/.test(char) || this.value.length >= 10) {
                    e.preventDefault();
                }
            });

            contactInput.addEventListener("input", function () {
                let value = this.value.replace(/\D/g, "");

                if (value.length === 1 && !/[6-9]/.test(value[0])) {
                    value = "";
                }

                if (value.length > 10) {
                    value = value.slice(0, 10);
                }

                this.value = value;
                checkPatientForm();
            });

            contactInput.addEventListener("paste", function (e) {
                e.preventDefault();
                const text = (e.originalEvent || e).clipboardData.getData("text/plain");
                const cleanedText = text.replace(/[^0-9]/g, "").slice(0, 10);
                this.value = cleanedText;
                checkPatientForm();
            });
        });

        let doctors = [];
        let lastFilteredDoctors = [];
        let currentPage = 1;
        const doctorsPerPage = 4;

        async function fetchDoctorsFromDB() {
            const response = await fetch("/api/doctors");
            if (!response.ok) throw new Error("Failed to fetch doctors");
            return await response.json();
        }

        function populateSpecialtyDropdown(doctors) {
            const specialtySet = new Set();
            doctors.forEach((doc) => {
                if (doc.specialty) specialtySet.add(doc.specialty);
            });
            const specialtyFilter = document.getElementById("specialtyFilter");
            specialtyFilter.innerHTML = "";
            const allOption = document.createElement("option");
            allOption.value = "";
            allOption.textContent = "All Specialties";
            specialtyFilter.appendChild(allOption);
            Array.from(specialtySet)
                .sort()
                .forEach((specialty) => {
                    const option = document.createElement("option");
                    option.value = specialty;
                    option.textContent = specialty;
                    specialtyFilter.appendChild(option);
                });
        }

        window.addEventListener("DOMContentLoaded", async () => {
            try {
                doctors = await fetchDoctorsFromDB();
                populateSpecialtyDropdown(doctors);
                lastFilteredDoctors = doctors;
                currentPage = 1;
                displayDoctors();
                updatePagination(lastFilteredDoctors.length);
            } catch (err) {
                showToast("Failed to load doctors: " + err.message, 'error');
            }
        });

        function filterDoctors() {
            const searchTerm = document.getElementById("searchInput").value.toLowerCase();
            const specialty = document.getElementById("specialtyFilter").value;

            currentPage = 1;
            lastFilteredDoctors = doctors.filter((doctor) => {
                const matchesSearch = doctor.name.toLowerCase().includes(searchTerm) || (doctor.specialty && doctor.specialty.toLowerCase().includes(searchTerm));
                const matchesSpecialty = !specialty || doctor.specialty === specialty;
                return matchesSearch && matchesSpecialty;
            });

            displayDoctors(lastFilteredDoctors);
        }

        function getDoctorDisplayName(name) {
            if (!name) return "";
            return name.trim().toLowerCase().startsWith("dr.") ? name.trim() : `Dr. ${name.trim()}`;
        }

        function displayDoctors(filteredDoctors = lastFilteredDoctors) {
            const doctorList = document.getElementById("doctorList");
            const start = (currentPage - 1) * doctorsPerPage;
            const end = start + doctorsPerPage;
            const paginatedDoctors = filteredDoctors.slice(start, end);
            const selectedDoctorData = JSON.parse(localStorage.getItem("selectedDoctor"));
            const isEditMode = getQueryParam("edit") === "1";

            doctorList.innerHTML = paginatedDoctors
                .map((doctor) => {
                    const isSelected = selectedDoctorData && selectedDoctorData.name === doctor.name;
                    const buttonClass =
                        isSelected && isEditMode
                            ? "select-btn bg-gray-400 text-white cursor-not-allowed opacity-60"
                            : isSelected
                                ? "select-btn bg-blue-500 hover:bg-blue-600 text-white"
                                : "select-btn bg-black text-white hover:bg-gray-800";
                    const disabledAttr = isEditMode && isSelected ? "disabled" : "";
                    const experience = doctor.experience ? `${doctor.experience} yrs` : "";
                    const qualification = doctor.qualification ? `${doctor.qualification}` : "";
                    const infoLine = experience && qualification ? `${experience} · ${qualification}` : experience || qualification;
                    return `
          <div class="flex justify-between items-center border p-4 rounded-md doctor" data-specialty="${doctor.specialty}">
            <div>
              <p class="font-bold text-lg">${getDoctorDisplayName(doctor.name)}</p>
              <p class="text-gray-600">${doctor.specialty || ""}</p>
              <p class="text-sm text-gray-500">${infoLine}</p>
            </div>
            <button onclick="selectDoctor('${doctor.name}', '${doctor.specialty}', '${doctor.experience}', '${doctor.qualification}', '${doctor.availability}', '${doctor.availabilityByDate ? JSON.stringify(doctor.availabilityByDate).replace(/"/g, "&quot;") : ""
                        }')" 
              class="${buttonClass} px-4 py-2 rounded transition-colors duration-200"
              data-doctor="${doctor.name}" ${disabledAttr}>
              Select
            </button>
          </div>
        `;
                })
                .join("");

            updatePagination(filteredDoctors.length);
            if (selectedDoctorData) {
                document.getElementById("doctorNextBtn").disabled = false;
                document.getElementById("doctorNextBtn").classList.remove("bg-gray-400");
                document.getElementById("doctorNextBtn").classList.add("bg-blue-600");
            }
        }

        function updatePagination(totalDoctors) {
            const totalPages = Math.ceil(totalDoctors / doctorsPerPage);
            document.getElementById("pageInfo").textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById("prevBtn").disabled = currentPage === 1;
            document.getElementById("nextBtn").disabled = currentPage === totalPages;
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                displayDoctors(lastFilteredDoctors);
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(lastFilteredDoctors.length / doctorsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayDoctors(lastFilteredDoctors);
            }
        }

        function selectDoctor(name, specialty, experience, qualification, availability, availabilityByDate) {
            const doctorData = {
                name: name,
                specialty: specialty,
                experience: experience,
                qualification: qualification,
                availability: availability,
                availabilityByDate: availabilityByDate ? JSON.parse(availabilityByDate.replace(/&quot;/g, '"')) : null,
            };
            localStorage.setItem("selectedDoctor", JSON.stringify(doctorData));
            document.getElementById("doctorNextBtn").disabled = false;
            document.getElementById("doctorNextBtn").classList.remove("bg-gray-400");
            document.getElementById("doctorNextBtn").classList.add("bg-blue-600");

            const selectButtons = document.querySelectorAll(".select-btn");
            selectButtons.forEach((button) => {
                button.classList.remove("bg-blue-500", "hover:bg-blue-600");
                button.classList.add("bg-black", "hover:bg-gray-800");

                if (button.getAttribute("data-doctor") === name) {
                    button.classList.remove("bg-black", "hover:bg-gray-800");
                    button.classList.add("bg-blue-500", "hover:bg-blue-600");
                }
            });
        }

        function showSection(sectionId) {
            document.querySelectorAll(".section").forEach((section) => {
                section.classList.remove("active");
            });

            document.getElementById(sectionId).classList.add("active");
        }

        function updateStepper(activeStep) {
            for (let i = 1; i <= 5; i++) {
                const circle = document.getElementById(`step${i}`);
                const label = document.getElementById(`step${i}Text`);

                if (i < activeStep) {
                    circle.classList.remove("text-gray-400", "border-gray-200");
                    circle.classList.add("text-blue-600", "border-blue-600");
                    circle.textContent = "✓";
                    label.classList.remove("text-gray-400");
                    label.classList.add("text-blue-600");
                } else if (i === activeStep) {
                    circle.classList.remove("text-gray-400", "border-gray-200");
                    circle.classList.add("text-blue-600", "border-blue-600");
                    circle.textContent = i.toString();
                    label.classList.remove("text-gray-400");
                    label.classList.add("text-blue-600");
                } else {
                    circle.classList.remove("text-blue-600", "border-blue-600");
                    circle.classList.add("text-gray-400", "border-gray-200");
                    circle.textContent = i.toString();
                    label.classList.remove("text-blue-600");
                    label.classList.add("text-gray-400");
                }
            }

            const line1_2_part1 = document.getElementById("line1");
            const line1_2_part2 = document.getElementById("line2Left");

            const line2_3_part1 = document.getElementById("line2Right");
            const line2_3_part2 = document.getElementById("line3Left");

            const line3_4_part1 = document.getElementById("line3Right");
            const line3_4_part2 = document.getElementById("line4Left");

            const line4_5_part1 = document.getElementById("line4Right");
            const line4_5_part2 = document.getElementById("line5");

            [line1_2_part1, line1_2_part2, line2_3_part1, line2_3_part2, line3_4_part1, line3_4_part2, line4_5_part1, line4_5_part2].forEach((line) => {
                if (line) {
                    line.classList.remove("bg-blue-600");
                    line.classList.add("bg-gray-200");
                }
            });

            if (activeStep >= 2) {
                if (line1_2_part1) {
                    line1_2_part1.classList.remove("bg-gray-200");
                    line1_2_part1.classList.add("bg-blue-600");
                }
                if (line1_2_part2) {
                    line1_2_part2.classList.remove("bg-gray-200");
                    line1_2_part2.classList.add("bg-blue-600");
                }
            }
            if (activeStep >= 3) {
                if (line2_3_part1) {
                    line2_3_part1.classList.remove("bg-gray-200");
                    line2_3_part1.classList.add("bg-blue-600");
                }
                if (line2_3_part2) {
                    line2_3_part2.classList.remove("bg-gray-200");
                    line2_3_part2.classList.add("bg-blue-600");
                }
            }
            if (activeStep >= 4) {
                if (line3_4_part1) {
                    line3_4_part1.classList.remove("bg-gray-200");
                    line3_4_part1.classList.add("bg-blue-600");
                }
                if (line3_4_part2) {
                    line3_4_part2.classList.remove("bg-gray-200");
                    line3_4_part2.classList.add("bg-blue-600");
                }
            }
            if (activeStep >= 5) {
                if (line4_5_part1) {
                    line4_5_part1.classList.remove("bg-gray-200");
                    line4_5_part1.classList.add("bg-blue-600");
                }
                if (line4_5_part2) {
                    line4_5_part2.classList.remove("bg-gray-200");
                    line4_5_part2.classList.add("bg-blue-600");
                }
            }
        }

        document.getElementById("patientForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            const patientData = {
                name: formData.get("name"),
                age: formData.get("age"),
                ageDisplay: document.getElementById("age").options[document.getElementById("age").selectedIndex].text,
                gender: formData.get("gender"),
                blood: formData.get("blood"),
                contact: formData.get("contact"),
                symptoms: formData.get("symptoms")

            };

            localStorage.setItem("patientData", JSON.stringify(patientData));
            goToDoctorSection();
        });

        document.getElementById("patientNextBtn").addEventListener("click", function () {
            document.getElementById("patientForm").dispatchEvent(new Event("submit"));
        });

        function goToDoctorSection() {
            showSection("doctorSection");
            updateStepper(2);
            displayDoctors();
        }

        function goBack() {
            const currentSection = document.querySelector(".section.active").id;
            if (currentSection === "doctorSection") {
                const isEditMode = getQueryParam("edit") === "1";
                if (isEditMode) {
                    window.location.href = "admindasboard.html";
                    return;
                }

                showSection("patientSection");
                updateStepper(1);
                const patientData = JSON.parse(localStorage.getItem("patientData") || "{}");
                if (patientData) {
                    document.getElementById("patient-name").value = patientData.name || "";
                    document.getElementById("age").value = patientData.age || "";
                    document.getElementById("patient-gender").value = patientData.gender || "";
                    document.getElementById("blood-group").value = patientData.blood || "";
                    document.getElementById("contact-number").value = patientData.contact || "";
                    checkPatientForm();
                }
            }
        }

        function goToDateTimeSection() {
            showSection("dateTimeSection");
            updateStepper(3);
            initializeDateTime();
        }

        function goBackToDoctor() {
            showSection("doctorSection");
            updateStepper(2);
        }

        function goToReferral() {
            showSection("referralSection");
            updateStepper(4);
            
        
            setTimeout(() => {
                checkReferralForm();
            }, 100);
        }

        function goBackToDateTime() {
            showSection("dateTimeSection");
            updateStepper(3);
            const appointmentData = JSON.parse(localStorage.getItem("appointmentData") || "{}");
            if (appointmentData.date && appointmentData.time) {
                selectedDate = appointmentData.date;
                selectedTime = appointmentData.time;
                const [month, day, year] = selectedDate.split("/");
                currentDate = new Date(year, month - 1, day);
                renderCalendar(currentDate);
                updateMonthNavigation();
                updateTimeSlots();
            }
        }

        function skipReferral() {
            const referralInput = document.getElementById("referred-by");
            const referralValue = referralInput.value.trim();
            
            if (referralValue.length > 0) {
            
                const referralError = document.getElementById("referral-error");
                referralError.textContent = "Please use Next button when referral name is entered, or clear the field to skip";
                referralError.classList.remove("hidden");
                referralInput.classList.add("border-red-500");
                return;
            }
            
            localStorage.setItem("referralData", JSON.stringify({ referredBy: "" }));
            goToConfirmationFromReferral();
        }

        function goToConfirmationFromReferral() {
            const referralInput = document.getElementById("referred-by");
            const referralValue = referralInput.value.trim();
            
            
            const referralData = {
                referredBy: referralValue
            };
            localStorage.setItem("referralData", JSON.stringify(referralData));
            
            
            const referralError = document.getElementById("referral-error");
            if (referralError) referralError.classList.add("hidden");
            referralInput.classList.remove("border-red-500");
            
            const isEditMode = getQueryParam("edit") === "1";
            if (isEditMode) {
            
                showSection("confirmationSection");
                updateStepper(5);
                initializeConfirmation();
            } else if (selectedDate && selectedTime) {
                const appointmentData = {
                    date: selectedDate,
                    time: selectedTime,
                };
                localStorage.setItem("appointmentData", JSON.stringify(appointmentData));
                showSection("confirmationSection");
                updateStepper(5);
                initializeConfirmation();
            }
        }

        function goBackToReferral() {
            showSection("referralSection");
            updateStepper(4);
        }

        function goToConfirmation() {
            if (selectedDate && selectedTime) {
                const appointmentData = {
                    date: selectedDate,
                    time: selectedTime,
                };
                localStorage.setItem("appointmentData", JSON.stringify(appointmentData));
                showSection("confirmationSection");
                updateStepper(5);
                initializeConfirmation();
            }
        }

        function checkPatientForm() {
            const name = document.getElementById("patient-name").value.trim();
            const age = document.getElementById("age").value;
            const gender = document.getElementById("patient-gender").value;
            const blood = document.getElementById("blood-group").value;
            const contact = document.getElementById("contact-number").value;
            const nextButton = document.getElementById("patientNextBtn");
            if (name && age && gender && blood && contact.length === 10) {
                nextButton.disabled = false;
                nextButton.classList.remove("bg-gray-400");
                nextButton.classList.add("bg-blue-600");
                return true;
            } else {
                nextButton.disabled = true;
                nextButton.classList.add("bg-gray-400");
                nextButton.classList.remove("bg-blue-600");
                return false;
            }
        }
        document.addEventListener("DOMContentLoaded", () => {
            const nextButton = document.getElementById("patientNextBtn");
            nextButton.disabled = true;
            nextButton.classList.add("bg-gray-400");
            nextButton.classList.remove("bg-blue-600");
            document.getElementById("patient-name").required = true;
            document.getElementById("age").required = true;
            document.getElementById("patient-gender").required = true;
            document.getElementById("blood-group").required = true;
            document.getElementById("contact-number").required = true;
            const formInputs = ["patient-name", "age", "patient-gender", "blood-group", "contact-number"];

            formInputs.forEach((inputId) => {
                const element = document.getElementById(inputId);
                ["input", "change", "blur"].forEach((eventType) => {
                    element.addEventListener(eventType, () => {
                        checkPatientForm();
                        if (!element.value) {
                            element.classList.add("border-red-500");

                            let errorDiv = element.nextElementSibling;
                            if (!errorDiv || !errorDiv.classList.contains("error-message")) {
                                errorDiv = document.createElement("div");
                                errorDiv.className = "error-message text-red-500 text-sm mt-1";
                                element.parentNode.insertBefore(errorDiv, element.nextSibling);
                            }
                            errorDiv.textContent = "This field is required";
                        } else {
                            element.classList.remove("border-red-500");

                            const errorDiv = element.nextElementSibling;
                            if (errorDiv && errorDiv.classList.contains("error-message")) {
                                errorDiv.remove();
                            }
                        }
                    });
                });
            });

            const contactInput = document.getElementById("contact-number");
            contactInput.addEventListener("blur", () => {
                if (contactInput.value && contactInput.value.length !== 10) {
                    contactInput.classList.add("border-red-500");
                    let errorDiv = contactInput.nextElementSibling;
                    if (!errorDiv || !errorDiv.classList.contains("error-message")) {
                        errorDiv = document.createElement("div");
                        errorDiv.className = "error-message text-red-500 text-sm mt-1";
                        contactInput.parentNode.insertBefore(errorDiv, contactInput.nextSibling);
                    }
                    errorDiv.textContent = "Contact number must be 10 digits";
                }
            });

            const nameInput = document.getElementById("patient-name");
        });

        const doctorUnavailableDates = {
            "Dr. Sarah Johnson": ["6/26/2025"],
            "Dr. Michael Chen": ["6/28/2025"],
            "Dr. Srivani": ["6/29/2025"],
        };

        let currentDate = new Date();
        let selectedDate = null;
        let selectedTime = null;
        let selectedDoctor = null;

        function formatDateString(date) {
            return `${date.getMonth() + 1}/${date.getDate()}/${date.getFullYear()}`;
        }

        function getLunchBreakSlots(lunchBreak) {
            const [start, end] = lunchBreak.split("-");
            const startTime = start.trim();
            const endTime = end.trim();
            const slots = [];
            let foundStart = false;

            for (const slot of allTimeSlots) {
                if (slot === startTime) {
                    foundStart = true;
                }
                if (foundStart) {
                    slots.push(slot);
                }
                if (slot === endTime) {
                    break;
                }
            }

            return slots;
        }

        function isTimeSlotAvailable(doctor, time) {
            const restrictions = doctorRestrictions[doctor.name];
            if (restrictions) {
                const lunchBreakSlots = getLunchBreakSlots(restrictions.lunchBreak);
                if (lunchBreakSlots.includes(time)) {
                    return false;
                }

                if (restrictions.unavailableTimes && restrictions.unavailableTimes.includes(time)) {
                    return false;
                }
            }
            return true;
        }

       function renderCalendar(date) {
  const monthLabel = document.getElementById("monthLabel");
  const daysContainer = document.getElementById("daysContainer");
  const dayNames = document.getElementById("dayNames");

  const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
  dayNames.innerHTML = days.map((d) => `<div class="text-center font-medium">${d}</div>`).join("");

  daysContainer.innerHTML = "";

  const year = date.getFullYear();
  const month = date.getMonth();
  const monthName = date.toLocaleString("default", { month: "long" });
  monthLabel.textContent = `${monthName} ${year}`;

  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  for (let i = 0; i < firstDay; i++) {
    const emptyDay = document.createElement("div");
    emptyDay.className = "h-10";
    daysContainer.appendChild(emptyDay);
  }

  const today = new Date();
  today.setHours(0, 0, 0, 0);

  
  const startOfWeek = new Date(today);
  const endOfWeek = new Date(startOfWeek);
  endOfWeek.setDate(startOfWeek.getDate() + 6);

  for (let day = 1; day <= daysInMonth; day++) {
    const thisDate = new Date(year, month, day);
    thisDate.setHours(0, 0, 0, 0);
    const dateString = formatDateString(thisDate);

    const dayDiv = document.createElement("div");
    dayDiv.textContent = day;

    let className = "calendar-day h-10 flex items-center justify-center rounded-full font-medium ";

    const isPast = thisDate < today;
    const isInThisWeek = thisDate >= startOfWeek && thisDate <= endOfWeek;
    const isUnavailable = selectedDoctor && doctorUnavailableDates[selectedDoctor.name]?.includes(dateString);

    if (isPast) {
      className += "text-gray-400 cursor-not-allowed opacity-40";
    } else if (isUnavailable) {
      className += "bg-red-100 text-gray-600 cursor-not-allowed";
    } else if (isInThisWeek) {
      className += "bg-green-100 text-gray-800 cursor-pointer hover:bg-green-200";
      dayDiv.addEventListener("click", () => selectDate(dateString, dayDiv));
    } else {
      className += "text-gray-400 cursor-not-allowed opacity-50";
    }

    if (selectedDate === dateString) {
      className += " selected bg-green-500 text-white hover:bg-green-600";
    }

    dayDiv.className = className;
    dayDiv.setAttribute("data-date", dateString);
    daysContainer.appendChild(dayDiv);
  }
}

        const bookedSlotsCache = new Map();

        async function getBookedSlots(doctorName, date) {
            const cacheKey = `${doctorName}-${date}`;

            if (bookedSlotsCache.has(cacheKey)) {
                return bookedSlotsCache.get(cacheKey);
            }

            try {
                const response = await fetch(`/api/confirmations/booked-slots?doctorName=${encodeURIComponent(doctorName)}&date=${encodeURIComponent(date)}`);
                if (!response.ok) {
                    throw new Error("Failed to fetch booked slots");
                }
                const data = await response.json();
                const bookedTimes = data.bookedTimes || [];

                bookedSlotsCache.set(cacheKey, bookedTimes);

                return bookedTimes;
            } catch (error) {
                console.error("Error fetching booked slots:", error);
                return [];
            }
        }

        function convertTo24Hour(time) {
            if (time.includes("-")) {
                time = time.split("-")[0].trim();
            }
            const [timeStr, period] = time.split(" ");
            const [hours, minutes] = timeStr.split(":");
            let hour = parseInt(hours);
            const isPM = period === "PM";

            if (isPM && hour !== 12) {
                hour += 12;
            } else if (!isPM && hour === 12) {
                hour = 0;
            }

            return hour * 60 + parseInt(minutes || 0);
        }

        function isTimeSlotPast(timeStr) {
            const now = new Date();
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (selectedDate !== formatDateString(today)) {
                return false;
            }

            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            const slotMinutes = convertTo24Hour(timeStr);

            return slotMinutes <= currentMinutes;
        }

        async function updateTimeSlots() {
            const timeSlotsContainer = document.querySelector("#timeSlots .grid");
            timeSlotsContainer.innerHTML = "";

            if (!selectedDoctor || !selectedDate) return;

            const bookedSlots = await getBookedSlots(selectedDoctor.name, selectedDate);
            let availabilityToUse = selectedDoctor.availability;
            if (selectedDoctor.availabilityByDate) {
                let dateKey = selectedDate;

                if (selectedDoctor.availabilityByDate[dateKey]) {
                    const dayAvail = selectedDoctor.availabilityByDate[dateKey];
                    availabilityToUse = `${dayAvail.start} - ${dayAvail.end}`;
                } else {
                    const parts = dateKey.split("/");
                    if (parts.length === 3) {
                        const ymd = `${parts[2]}-${parts[0].padStart(2, "0")}-${parts[1].padStart(2, "0")}`;
                        if (selectedDoctor.availabilityByDate[ymd]) {
                            const dayAvail = selectedDoctor.availabilityByDate[ymd];
                            availabilityToUse = `${dayAvail.start} - ${dayAvail.end}`;
                        }
                    }
                }
            }
            let doctorAvailableSlots = generateTimeSlots(availabilityToUse);

            doctorAvailableSlots = doctorAvailableSlots.sort((a, b) => {
                const timeA = a.split(" - ")[0];
                const timeB = b.split(" - ")[0];
                return convertTo24Hour(timeA) - convertTo24Hour(timeB);
            });
function timeStringToMinutes(timeStr) {
    let [time, period] = timeStr.split(' ');
    let [hours, minutes] = time.split(':').map(Number);
    if (period === 'PM' && hours < 12) hours += 12;
    if (period === 'AM' && hours === 12) hours = 0;
    return hours * 60 + (minutes || 0);
}
function isSlotInLunch(slot, lunchStart, lunchEnd) {
    const m = timeStringToMinutes;
    return m(slot) >= m(lunchStart) && m(slot) < m(lunchEnd);
}
const lunchStart = "1:00 PM";
const lunchEnd = "2:00 PM";
doctorAvailableSlots = doctorAvailableSlots.filter(
    slot => !isSlotInLunch(slot, lunchStart, lunchEnd)
);


            doctorAvailableSlots.forEach((time) => {
                if (time === "1:00 PM - 2:00 PM") return;

                const timeSlot = document.createElement("div");
                const isBooked = bookedSlots.includes(time);
                const isPastTime = isTimeSlotPast(time);

                if (isBooked) {
                    timeSlot.className = "time-slot p-2 text-center border rounded bg-red-100 text-red-600 cursor-not-allowed";
                    timeSlot.innerHTML = `${time}<br><span class="text-sm">Booked</span>`;
                } else if (isPastTime) {
                    timeSlot.className = "time-slot p-2 text-center border rounded bg-gray-300 text-gray-600 cursor-not-allowed";
                    timeSlot.textContent = time;
                } else {
                    timeSlot.className = "time-slot p-2 text-center border rounded cursor-pointer hover:bg-gray-100";
                    timeSlot.textContent = time;

                    const savedAppointment = JSON.parse(localStorage.getItem("appointmentData") || "{}");
                    if (savedAppointment.date === selectedDate && savedAppointment.time === time) {
                        timeSlot.classList.add("selected", "bg-green-500", "text-white");
                        selectedTime = time;
                        document.getElementById("dateTimeNextBtn").disabled = false;
                        document.getElementById("dateTimeNextBtn").classList.remove("bg-gray-400");
                        document.getElementById("dateTimeNextBtn").classList.add("bg-blue-600");
                    }

                    timeSlot.addEventListener("click", () => {
                        document.querySelectorAll(".time-slot.selected").forEach((slot) => {
                            slot.classList.remove("selected", "bg-green-500", "text-white");
                        });

                        timeSlot.classList.add("selected", "bg-green-500", "text-white");
                        selectedTime = time;

                        document.getElementById("dateTimeNextBtn").disabled = false;
                        document.getElementById("dateTimeNextBtn").classList.remove("bg-gray-400");
                        document.getElementById("dateTimeNextBtn").classList.add("bg-blue-600");
                    });
                }

                timeSlotsContainer.appendChild(timeSlot);
            });

            const lunchSlot = document.createElement("div");
            lunchSlot.className = "time-slot p-2 text-center border rounded bg-gray-100 text-gray-600 cursor-not-allowed col-span-3";
            lunchSlot.innerHTML = `1:00 PM - 2:00 PM <span style="margin-left:12px;" class="text-sm">Lunch Break</span>`;
            lunchSlot.setAttribute("data-tooltip", "Lunch Break");

            const slots = Array.from(timeSlotsContainer.children);
            const lunchIndex = slots.findIndex((slot) => {
                const time = slot.textContent.split(" - ")[0];
                return convertTo24Hour(time) >= convertTo24Hour("1:00 PM");
            });

            if (lunchIndex !== -1) {
                timeSlotsContainer.insertBefore(lunchSlot, slots[lunchIndex]);
            } else {
                timeSlotsContainer.appendChild(lunchSlot);
            }

            document.getElementById("timeSlots").classList.remove("hidden");
            document.getElementById("noTime").classList.add("hidden");
            document.getElementById("loadingTime").classList.add("hidden");
        }

        function selectDate(date, element) {
            document.querySelectorAll(".calendar-day.selected").forEach((el) => el.classList.remove("selected", "bg-green-500", "text-white", "hover:bg-green-600"));

            element.classList.add("selected", "bg-green-500", "text-white", "hover:bg-green-600");
            selectedDate = date;

            selectedTime = null;
            document.getElementById("dateTimeNextBtn").disabled = true;
            document.getElementById("dateTimeNextBtn").classList.add("bg-gray-400");
            document.getElementById("dateTimeNextBtn").classList.remove("bg-blue-600");

            document.getElementById("noTime").style.display = "none";
            document.getElementById("timeSlots").style.display = "none";
            document.getElementById("loadingTime").style.display = "flex";

            updateTimeSlots()
                .then(() => {
                    document.getElementById("loadingTime").style.display = "none";
                    document.getElementById("timeSlots").style.display = "block";
                })
                .catch((error) => {
                    console.error("Error updating time slots:", error);
                    document.getElementById("loadingTime").style.display = "none";
                    document.getElementById("noTime").style.display = "flex";
                    document.getElementById("noTime").innerHTML = `
            <svg class="w-16 h-16 mb-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <p class="text-center text-red-500">Error loading time slots. Please try again.</p>
          `;
                });
        }

        function changeMonth(offset) {
            const newDate = new Date(currentDate);
            newDate.setMonth(newDate.getMonth() + offset);

            currentDate = newDate;
            renderCalendar(currentDate);
            updateMonthNavigation();
        }

        function updateMonthNavigation() {
            const prevButton = document.querySelector('button[onclick="changeMonth(-1)"]');
            const nextButton = document.querySelector('button[onclick="changeMonth(1)"]');

            const today = new Date();
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            const todayMonth = today.getMonth();
            const todayYear = today.getFullYear();

            const isPrevDisabled = currentMonth <= todayMonth && currentYear <= todayYear;
            prevButton.disabled = isPrevDisabled;
            prevButton.classList.toggle("opacity-50", isPrevDisabled);
            prevButton.classList.toggle("cursor-not-allowed", isPrevDisabled);

            nextButton.disabled = false;
            nextButton.classList.remove("opacity-50", "cursor-not-allowed");
        }

        function initializeDateTime() {
            selectedDoctor = JSON.parse(localStorage.getItem("selectedDoctor"));
            const savedAppointment = JSON.parse(localStorage.getItem("appointmentData") || "{}");

            if (savedAppointment.date && savedAppointment.time) {
                selectedDate = savedAppointment.date;
                selectedTime = savedAppointment.time;

                const [month, day, year] = savedAppointment.date.split("/");
                currentDate = new Date(year, month - 1, day);
            } else {
                currentDate = new Date();
                selectedDate = null;
                selectedTime = null;
            }

            renderCalendar(currentDate);
            updateMonthNavigation();
            

            if (selectedDate) {
                setTimeout(() => {
                    const calendarDays = document.querySelectorAll(".calendar-day");
                    const selectedDay = Array.from(calendarDays).find((day) => {
                        const dayNum = parseInt(day.textContent);
                        const [month, date, year] = selectedDate.split("/");
                        return dayNum === parseInt(date);
                    });

                    if (selectedDay) {
                        selectedDay.classList.add("selected", "bg-green-500", "text-white", "hover:bg-green-600");
                    }

                    document.getElementById("noTime").style.display = "none";
                    document.getElementById("timeSlots").style.display = "block";
                    updateTimeSlots();
                }, 100);
                
            }
        }

        function goBackToDoctor() {
            showSection("doctorSection");
            updateStepper(2);
        }

        function goToReferral() {
            showSection("referralSection");
            updateStepper(4);
            
        
            setTimeout(() => {
                checkReferralForm();
            }, 100);
        }

        function goBackToDateTime() {
            showSection("dateTimeSection");
            updateStepper(3);
            const appointmentData = JSON.parse(localStorage.getItem("appointmentData") || "{}");
            if (appointmentData.date && appointmentData.time) {
                selectedDate = appointmentData.date;
                selectedTime = appointmentData.time;
                const [month, day, year] = selectedDate.split("/");
                currentDate = new Date(year, month - 1, day);
                renderCalendar(currentDate);
                updateMonthNavigation();
                updateTimeSlots();
            }
        }

        async function confirmBooking() {
            if (getQueryParam("edit") === "1") {
                let editData = null;
                try {
                    editData = JSON.parse(localStorage.getItem("editAppointment"));
                } catch (e) {
                    localStorage.removeItem("editAppointment");
                    showSuccessModal("Error: Corrupted appointment data for editing.", "Appointment update failed.", "error");
                    return;
                }
                if (!editData || !editData._id) {
                    localStorage.removeItem("editAppointment");
                    showSuccessModal("Error: Missing or invalid appointment data for editing.", "Appointment update failed.", "error");
                    return;
                }
            }

            try {
                const patientData = JSON.parse(localStorage.getItem("patientData"));
                const doctorData = JSON.parse(localStorage.getItem("selectedDoctor"));
                const appointmentData = JSON.parse(localStorage.getItem("appointmentData"));
                const referralData = JSON.parse(localStorage.getItem("referralData") || "{}");

                if (!patientData || !doctorData || !appointmentData) {
                    throw new Error("Missing required appointment information");
                }

                const confirmationData = {
                    patientData: {
                        name: (patientData.name || "").trim(),
                        age: Number(patientData.age),
                        gender: (patientData.gender || "").trim(),
                        blood: (patientData.blood || "").trim(),
                        contact: (patientData.contact || "").trim(),
                    },
                    doctorData: {
                        name: (doctorData.name || "").trim(),
                        specialty: (doctorData.specialty || "").trim(),
                    },
                    dateData: {
                        date: (appointmentData.date || "").trim(),
                        time: (appointmentData.time || "").trim(),
                    },
                    referralData: {
                        referredBy: (referralData.referredBy || "").trim(),
                    },
                };
                console.log("Sending confirmationData:", confirmationData);

                
                if (referralData.referredBy && referralData.referredBy.trim() !== "") {
                    if (referralData.referredBy.trim().length < 2) {
                        showSuccessModal("Referral doctor name must be at least 2 characters long.", "Appointment booking failed.", "error");
                        return;
                    }
                }

                for (const key in confirmationData.patientData) {
                    if (
                        confirmationData.patientData[key] === "" ||
                        confirmationData.patientData[key] === null ||
                        confirmationData.patientData[key] === undefined ||
                        (key === "age" && isNaN(confirmationData.patientData[key]))
                    ) {
                        showSuccessModal("Missing or invalid patient data: " + key, "Appointment update failed.", "error");
                        return;
                    }
                }
                for (const key in confirmationData.doctorData) {
                    if (!confirmationData.doctorData[key]) {
                        showSuccessModal("Missing doctor data: " + key, "Appointment update failed.", "error");
                        return;
                    }
                }
                for (const key in confirmationData.dateData) {
                    if (!confirmationData.dateData[key]) {
                        showSuccessModal("Missing appointment date/time: " + key, "Appointment update failed.", "error");
                        return;
                    }
                }

                const confirmButton = document.getElementById("confirmBookingBtn");
                confirmButton.disabled = true;
                confirmButton.textContent = "Confirming...";
                confirmButton.classList.add("opacity-75");

                const isEditMode = getQueryParam("edit") === "1" && localStorage.getItem("editAppointment");
                let response;
                if (isEditMode) {
                    const editData = JSON.parse(localStorage.getItem("editAppointment"));
                    if (!editData || !editData._id) {
                        showSuccessModal("Error: Missing or invalid appointment data for editing.", "Appointment update failed.", "error");
                        return;
                    }

                    
                    if (referralData.referredBy && referralData.referredBy.trim() !== "") {
                        if (referralData.referredBy.trim().length < 2) {
                            showSuccessModal("Referral doctor name must be at least 2 characters long.", "Appointment update failed.", "error");
                            return;
                        }
                    }

                    response = await fetch(`/api/confirmations/${editData._id}`, {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            action: "edit",
                            patientData: confirmationData.patientData,
                            doctorName: confirmationData.doctorData.name,
                            date: confirmationData.dateData.date,
                            time: confirmationData.dateData.time,
                            referralData: confirmationData.referralData,
                        }),
                    });
                } else {
                    response = await fetch("/api/confirmations", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(confirmationData),
                    });
                }

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || "Failed to book appointment");
                }

                if (isEditMode && typeof bookedSlotsCache !== "undefined") {
                    bookedSlotsCache.clear();
                }

                document.getElementById("step4").innerHTML = "✓";
                const step5El = document.getElementById("step5");
                if (step5El) {
                    step5El.innerHTML = "✓";
                }

                showSuccessModal(isEditMode ? "Appointment updated successfully!" : "Appointment booked successfully!", "Appointment booked successfully!", "success");
                
                if (isEditMode) {
                    localStorage.removeItem("editAppointment");
                }
            } catch (error) {
                const confirmButton = document.getElementById("confirmBookingBtn");
                confirmButton.disabled = false;
                confirmButton.textContent = "Confirm Appointment";
                confirmButton.classList.remove("opacity-75");

                showSuccessModal(error.message || "Failed to book appointment. Please try again.", "Appointment booking failed.", "error");
            }
        }

        function initializeConfirmation() {
            const patientData = JSON.parse(localStorage.getItem("patientData"));
            const doctorData = JSON.parse(localStorage.getItem("selectedDoctor"));
            const appointmentData = JSON.parse(localStorage.getItem("appointmentData"));
            const referralData = JSON.parse(localStorage.getItem("referralData") || "{}");

            document.getElementById("confirmDoctor").textContent = doctorData.name;
            document.getElementById("confirmSpecialty").textContent = doctorData.specialty;
            document.getElementById("confirmExperience").textContent = doctorData.experience.split(" ")[0];

            const dateObj = new Date(appointmentData.date);
            const formattedDate = dateObj.toLocaleDateString("en-US", {
                weekday: "long",
                month: "long",
                day: "numeric",
                year: "numeric",
            });
            document.getElementById("confirmDate").textContent = formattedDate;

            document.getElementById("confirmTime").textContent = appointmentData.time;
            document.getElementById("confirmPatientName").textContent = patientData.name;
            document.getElementById("confirmPatientAge").textContent = patientData.age;
            document.getElementById("confirmPatientGender").textContent = patientData.gender;
            document.getElementById("confirmPatientBlood").textContent = patientData.blood;
            document.getElementById("confirmPatientContact").textContent = patientData.contact;
            document.getElementById("confirmPatientSymptoms").textContent = patientData.symptoms;

    
            const referralInfo = document.getElementById("referralInfo");
            const confirmReferral = document.getElementById("confirmReferral");
            
            if (referralData.referredBy && referralData.referredBy.trim() !== "") {
                confirmReferral.textContent = referralData.referredBy;
                referralInfo.classList.remove("hidden");
            } else {
                referralInfo.classList.add("hidden");
            }
        }

        const allTimeSlots = [
            "9:00 AM",
            "9:30 AM",
            "10:00 AM",
            "10:30 AM",
            "11:00 AM",
            "11:30 AM",
            "12:00 PM",
            "12:30 PM",
            "1:00 PM - 2:00 PM",
            "2:30 PM",
            "3:00 PM",
            "3:30 PM",
            "4:00 PM",
            "4:30 PM",
            "5:00 PM",
        ];

        function showSuccessModal(message, toastMessage = null, toastType = 'success') {
            document.getElementById("alertMessage").textContent = message;
            document.getElementById("overlay").style.display = "flex";
            window._pendingToast = toastMessage ? { message: toastMessage, type: toastType } : null;
        }
        function hideAlert() {
            document.getElementById("overlay").style.display = "none";
            if (window._pendingToast) {
                showToast(window._pendingToast.message, window._pendingToast.type);
                window._pendingToast = null;
            }
            if (document.getElementById("alertMessage").textContent.includes("successfully")) {
                localStorage.removeItem("appointmentData");
                localStorage.removeItem("selectedDoctor");
                localStorage.removeItem("patientData");
                localStorage.removeItem("lastBookedPatient");
                localStorage.removeItem("referralData");
                if (getQueryParam("edit") === "1") {
                    window.location.href = "admindasboard.html";
                } else {
                    showSection("patientSection");
                    updateStepper(1);
                    document.getElementById("patientForm").reset();
                    document.getElementById("patient-name").value = "";
                    document.getElementById("age").value = "";
                    document.getElementById("patient-gender").value = "";
                    document.getElementById("blood-group").value = "";
                    document.getElementById("contact-number").value = "";
                    const doctorButtons = document.querySelectorAll(".select-btn");
                    doctorButtons.forEach((button) => {
                        button.classList.remove("bg-blue-500", "hover:bg-blue-600");
                        button.classList.add("bg-black", "hover:bg-gray-800");
                    });
                    selectedDate = null;
                    selectedTime = null;
                    currentDate = new Date();
                    document.getElementById("patientNextBtn").classList.add("bg-gray-400");
                    document.getElementById("patientNextBtn").classList.remove("bg-blue-600");
                    document.getElementById("patientNextBtn").disabled = true;
                    document.getElementById("doctorNextBtn").disabled = true;
                    document.getElementById("doctorNextBtn").classList.add("bg-gray-400");
                    document.getElementById("doctorNextBtn").classList.remove("bg-blue-600");
                    document.getElementById("dateTimeNextBtn").disabled = true;
                    document.getElementById("dateTimeNextBtn").classList.add("bg-gray-400");
                    document.getElementById("dateTimeNextBtn").classList.remove("bg-blue-600");
                    window.location.reload();
                }
            }
        }

        function getQueryParam(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }

        const isEditMode = getQueryParam("edit") === "1" && localStorage.getItem("editAppointment");
        let editData = null;
        if (isEditMode) {
            try {
                editData = JSON.parse(localStorage.getItem("editAppointment"));
                if (!editData || !editData._id) {
                    showSuccessModal("Error: Missing or invalid appointment data for editing.", "Appointment update failed.", "error");
                    localStorage.removeItem("editAppointment");
                    throw new Error("Invalid edit data");
                }

                localStorage.setItem("patientData", JSON.stringify(editData.patientData));

                localStorage.setItem("selectedDoctor", JSON.stringify(editData.doctorData));

                localStorage.setItem(
                    "appointmentData",
                    JSON.stringify({
                        date: editData.dateData?.date,
                        time: editData.dateData?.time,
                    })
                );

                localStorage.setItem(
                    "referralData",
                    JSON.stringify({
                        referredBy: editData.referralData?.referredBy || "",
                    })
                );
            } catch (e) {
                showSuccessModal("Error: Corrupted appointment data for editing.", "Appointment update failed.", "error");
                localStorage.removeItem("editAppointment");
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            if (isEditMode && editData) {
                const pageTitle = document.getElementById("pageTitle");
                if (pageTitle) {
                    pageTitle.textContent = "Edit Appointment";
                }

                const stepperContainer = document.getElementById("stepperContainer");
                if (stepperContainer) {
                    stepperContainer.style.display = "none";
                }

                const patientData = editData.patientData;
                if (patientData) {
                    console.log("Setting patient data in edit mode:", patientData);

                    const populateFormFields = () => {
                        const nameField = document.getElementById("patient-name");
                        const ageField = document.getElementById("age");
                        const genderField = document.getElementById("patient-gender");
                        const bloodField = document.getElementById("blood-group");
                        const contactField = document.getElementById("contact-number");

                        console.log("Form fields found:", {
                            nameField: !!nameField,
                            ageField: !!ageField,
                            genderField: !!genderField,
                            bloodField: !!bloodField,
                            contactField: !!contactField,
                        });

                        if (nameField) nameField.value = patientData.name || "";
                        if (ageField) {
                            let ageValue = patientData.age;

                            if (typeof ageValue === "number") ageValue = String(ageValue);
                            if (typeof ageValue === "string") {
                                const match = ageValue.match(/^([0-9.]+)/);
                                if (match) ageValue = match[1];
                                if (ageValue === "100+") ageValue = "100";
                                if (ageValue === "Above 100") ageValue = "101";
                            }

                            if ([...ageField.options].some((opt) => opt.value === ageValue)) {
                                ageField.value = ageValue;
                            } else {
                                ageField.value = "";
                            }
                        }
                        if (genderField) genderField.value = patientData.gender || "";
                        if (bloodField) bloodField.value = patientData.blood || "";
                        if (contactField) contactField.value = patientData.contact || "";

                        const nextBtn = document.getElementById("patientNextBtn");
                        if (nextBtn) {
                            nextBtn.disabled = false;
                            nextBtn.classList.remove("bg-gray-400");
                            nextBtn.classList.add("bg-blue-600");
                        }
                    };

                    populateFormFields();

                    setTimeout(populateFormFields, 200);
                    setTimeout(populateFormFields, 500);
                }

                showSection("doctorSection");
                displayDoctors();

                const doctorBackBtn = document.getElementById("doctorBackBtn");
                const doctorNextBtn = document.getElementById("doctorNextBtn");
                if (doctorBackBtn) doctorBackBtn.style.display = "none";
                if (doctorNextBtn) {
                    doctorNextBtn.style.display = "";
                    doctorNextBtn.disabled = true;
                    doctorNextBtn.classList.add("bg-gray-400");
                    doctorNextBtn.classList.remove("bg-blue-600");
                }

                setTimeout(() => {
                    const doctorData = editData.doctorData;
                    if (doctorData && doctorData.name) {
                        const doctorButtons = document.querySelectorAll(".select-btn");
                        doctorButtons.forEach((button) => {
                            if (button.getAttribute("data-doctor") === doctorData.name) {
                                button.classList.remove("bg-black", "hover:bg-gray-800");
                                button.classList.add("bg-blue-500", "hover:bg-blue-600");
                            }
                        });
                    }
                }, 1000);

                
                if (editData.referralData && editData.referralData.referredBy) {
                    setTimeout(() => {
                        const referralInput = document.getElementById("referred-by");
                        if (referralInput) {
                            referralInput.value = editData.referralData.referredBy;
                            checkReferralForm(); 
                        }
                    }, 1000);
                } else {
                
                    setTimeout(() => {
                        checkReferralForm();
                    }, 1000);
                }
             }
        });

        function openCancelModal(app) {
            cancelAppointmentData = app;
            document.getElementById("cancelModalOverlay").classList.remove("hidden");
            document.body.classList.add("blurred-bg");
        }

        function closeCancelModal() {
            document.getElementById("cancelModalOverlay").classList.add("hidden");
            document.body.classList.remove("blurred-bg");
            cancelAppointmentData = null;
        }

        document.getElementById("closeCancelModal").onclick = closeCancelModal;
        document.getElementById("cancelCancelBtn").onclick = closeCancelModal;
        document.getElementById("cancelModalOverlay").onclick = function (e) {
            if (e.target === this) closeCancelModal();
        };

        document.getElementById("confirmCancelBtn").onclick = async function () {
            if (!cancelAppointmentData || !cancelAppointmentData._id) {
                alert("Error: Missing appointment ID.");
                return;
            }

            try {
                const confirmButton = document.getElementById("confirmCancelBtn");
                confirmButton.disabled = true;
                confirmButton.textContent = "Canceling...";
                confirmButton.classList.add("opacity-75");

                const response = await fetch(`/api/confirmations/${cancelAppointmentData._id}`, {
                    method: "DELETE",
                    headers: {
                        "Content-Type": "application/json",
                    },
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || "Failed to cancel appointment");
                }

                closeCancelModal();

                showSuccessModal("Appointment cancelled successfully!", "Appointment cancelled successfully!", "success");

                const currentDate = datePicker.value;
                const searchTerm = searchInput.value.trim();
                await renderAppointmentsList(currentDate, searchTerm);
            } catch (error) {
                console.error("Error cancelling appointment:", error);
                alert("Error cancelling appointment: " + error.message);

                const confirmButton = document.getElementById("confirmCancelBtn");
                confirmButton.disabled = false;
                confirmButton.textContent = "Yes, Cancel";
                confirmButton.classList.remove("opacity-75");
            }
        };

        document.addEventListener("DOMContentLoaded", function () {
            const doctorList = document.getElementById("doctorList");
            const nextBtn = document.getElementById("doctorNextBtn");

            fetch("/api/doctors")
                .then((res) => res.json())
                .then((doctors) => {
                    if (!doctors.length) {
                        doctorList.innerHTML = '<div class="text-gray-500">No doctors available.</div>';
                        return;
                    }
                    doctorList.innerHTML = doctors
                        .map(
                            (doctor) => `
            <div class="border p-4 rounded flex items-center gap-4 bg-white shadow">
              <input type="radio" name="selectedDoctor" value="${doctor._id}" id="doctor-${doctor._id}" class="mr-2" required>
              <label for="doctor-${doctor._id}" class="flex-1 cursor-pointer">
                <div class="font-bold text-lg">${doctor.name}</div>
                <div class="text-sm text-gray-600">${doctor.specialty || ""}</div>
                <div class="text-xs text-gray-500 mt-1">
                  ${doctor.experience ? `${doctor.experience} years exp` : ""}
                  ${doctor.qualification ? `• ${doctor.qualification}` : ""}
                  ${doctor.availability ? `<br>Available: ${doctor.availability}` : ""}
                </div>
              </label>
            </div>
          `
                        )
                        .join("");
                })
                .catch((err) => {
                    doctorList.innerHTML = '<div class="text-red-500">Failed to load doctors.</div>';
                });

            doctorList.addEventListener("change", function (e) {
                if (e.target && e.target.name === "selectedDoctor") {
                    nextBtn.disabled = false;
                    nextBtn.classList.remove("bg-gray-400");
                    nextBtn.classList.add("bg-blue-600");
                }
            });
        });

        if (document.getElementById("appointmentStatusFilter")) {
            document.getElementById("appointmentStatusFilter").addEventListener("change", function () {
                const status = this.value;
                const currentDate = datePicker.value;
                const searchTerm = searchInput.value.trim();
                renderAppointmentsList(currentDate, searchTerm, status);
            });
        }

        function generateTimeSlots(availability, intervalMinutes = 30) {
            if (!availability) return [];

            const [start, end] = availability.split("-").map((s) => s.trim());
            const slots = [];
            let current = parseTime(start);
            const endTime = parseTime(end);
            while (current < endTime) {
                slots.push(formatTime(current));
                current = new Date(current.getTime() + intervalMinutes * 60000);
            }
            return slots;
        }
        function parseTime(timeStr) {
            const [time, modifier] = timeStr.split(" ");
            let [hours, minutes] = time.split(":").map(Number);
            if (modifier === "PM" && hours !== 12) hours += 12;
            if (modifier === "AM" && hours === 12) hours = 0;
            const date = new Date(1970, 0, 1, hours, minutes);
            return date;
        }
        function formatTime(date) {
            let hours = date.getHours();
            const minutes = date.getMinutes();
            const ampm = hours >= 12 ? "PM" : "AM";
            hours = hours % 12;
            hours = hours ? hours : 12;
            return `${hours}:${minutes.toString().padStart(2, "0")} ${ampm}`;
        }

        function convertTo12Hour(hour, minute = 0) {
            const period = hour >= 12 ? "PM" : "AM";
            const adjustedHour = hour % 12 === 0 ? 12 : hour % 12;
            const paddedMinute = minute.toString().padStart(2, "0");
            return `${adjustedHour}:${paddedMinute} ${period}`;
        }

        let pendingRefreshEvent = null;
        function showRefreshWarningModal(e) {
            e.preventDefault();
            document.getElementById('refreshWarningModal').classList.remove('hidden');
            document.body.classList.add('blurred-bg');
            pendingRefreshEvent = e;
            return '';
        }
        function hideRefreshWarningModal() {
            document.getElementById('refreshWarningModal').classList.add('hidden');
            document.body.classList.remove('blurred-bg');
            pendingRefreshEvent = null;
        }
        document.getElementById('cancelRefreshBtn').onclick = function () {
            hideRefreshWarningModal();
        };
        document.getElementById('confirmRefreshBtn').onclick = function () {
            hideRefreshWarningModal();
            window.removeEventListener('beforeunload', beforeUnloadHandler);
            location.reload();
        };
        function beforeUnloadHandler(e) {
            var confirmationSection = document.getElementById('confirmationSection');
            if (confirmationSection && confirmationSection.classList.contains('active')) {
                showRefreshWarningModal(e);
                e.preventDefault();
                return '';
            }
        }
        window.removeEventListener('beforeunload', beforeUnloadHandler);
        window.addEventListener('beforeunload', beforeUnloadHandler);

        document.addEventListener('keydown', function (e) {
            var confirmationSection = document.getElementById('confirmationSection');
            if (confirmationSection && confirmationSection.classList.contains('active')) {
                if ((e.key === 'F5') || (e.ctrlKey && e.key.toLowerCase() === 'r')) {
                    e.preventDefault();
                    showRefreshWarningModal(e);
                }
            }
        });
        window.addEventListener('beforeunload', function (e) {
            var confirmationSection = document.getElementById('confirmationSection');
            if (confirmationSection && confirmationSection.classList.contains('active')) {
                e.preventDefault();
                e.returnValue = 'Are you sure you want to refresh? After refreshing, your details will be removed.';
                return 'Are you sure you want to refresh? After refreshing, your details will be removed.';
            }
        });

      function showToast(message, type = 'success') {
          const toast = document.getElementById('toast');
          toast.textContent = message;
          toast.className = 'fixed bottom-4 right-20 z-50 px-6 py-4 rounded-lg font-semibold text-white shadow-lg transition-all';
          toast.classList.add(type === 'success' ? 'bg-green-600' : 'bg-red-600');
          toast.classList.remove('hidden');
          setTimeout(() => {
            toast.classList.add('hidden');
          }, 2000);
        }

        function handleDoctorNext() {
            goToDateTimeSection();
        }

        function goToDateTimeSection() {
            showSection("dateTimeSection");
            updateStepper(3);
            initializeDateTime();
        }

        function checkReferralForm() {
    const referralInput = document.getElementById("referred-by");
    const referralNextBtn = document.getElementById("referralNextBtn");
    const skipReferralBtn = document.getElementById("skipReferralBtn");
    const referralError = document.getElementById("referral-error");
    let referralValue = referralInput.value.trim();
    if (referralValue.length > 0 && !referralValue.toLowerCase().startsWith("dr.")) {
        referralValue = "Dr. " + referralValue.replace(/^Dr\.\s*/i, "");
        referralInput.value = referralValue;
    }

 if (referralValue.length > 0) {
    referralNextBtn.disabled = false;
    referralNextBtn.classList.remove("bg-gray-400");
    referralNextBtn.classList.add("bg-blue-600");

    skipReferralBtn.disabled = true;
    skipReferralBtn.classList.add("bg-gray-400");
    skipReferralBtn.classList.remove("bg-blue-600");

    referralInput.classList.remove("border-red-500");
    referralInput.classList.add("border-green-500");
    referralError.classList.add("hidden");
} else {
    referralNextBtn.disabled = true;
    referralNextBtn.classList.add("bg-gray-400");
    referralNextBtn.classList.remove("bg-blue-600");

    skipReferralBtn.disabled = false;
    skipReferralBtn.classList.remove("bg-gray-400");
    skipReferralBtn.classList.add("bg-blue-600");

    referralInput.classList.remove("border-green-500");
    referralInput.classList.add("border-red-500");
    referralError.classList.remove("hidden");
}
        }
function skipReferral() {
    const referralInput = document.getElementById("referred-by");
    const referralValue = referralInput.value.trim();

    if (referralValue.length > 0) {
        const referralError = document.getElementById("referral-error");
        referralError.textContent = "Please use Next button when referral name is entered, or clear the field to skip";
        referralError.classList.remove("hidden");
        referralInput.classList.add("border-red-500");
        return;
    }

    localStorage.setItem("referralData", JSON.stringify({ referredBy: "" }));
    goToConfirmationFromReferral();
}

function clearReferralField() {
    const referralInput = document.getElementById("referred-by");
    referralInput.value = "";
    checkReferralForm();
}

    </script>

<script>

(function() {
  var theme = localStorage.getItem("theme") || "light";
  if (theme === "dark") {
    document.body.classList.add("dark");
  } else {
    document.body.classList.remove("dark");
  }
  var accent = localStorage.getItem("accent") || "blue";
  document.body.classList.remove(
    "accent-blue", "accent-green", "accent-brown",
    "accent-purple", "accent-orange", "accent-pink", "accent-teal"
  );
  if (accent !== "blue") {
    document.body.classList.add("accent-" + accent);
  }
})();
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
  
    const orgName = localStorage.getItem("orgName") || "MediCare";
    const orgLogo = localStorage.getItem("orgLogo") || "/images/Medicare-Emblem.png";

    const orgNameEl = document.getElementById("orgName");
    const orgLogoEl = document.getElementById("orgLogo");

    if (orgNameEl) orgNameEl.textContent = orgName;
    if (orgLogoEl) orgLogoEl.src = orgLogo;

    const btn = document.getElementById("backToDashboardBtn");
    const accent = localStorage.getItem("accent") || "blue";

    const accentClasses = {
      blue: ["bg-blue-600", "hover:bg-blue-700"],
      green: ["bg-green-600", "hover:bg-green-700"],
      pink: ["bg-pink-600", "hover:bg-pink-700"],
      orange: ["bg-orange-600", "hover:bg-orange-700"],
      purple: ["bg-purple-600", "hover:bg-purple-700"],
      teal: ["bg-teal-600", "hover:bg-teal-700"],
      brown: ["bg-brown-600", "hover:bg-brown-700"],
    };

    if (btn) {
      btn.classList.forEach(cls => {
        if (cls.startsWith("bg-") || cls.startsWith("hover:bg-")) {
          btn.classList.remove(cls);
        }
      });

      if (accentClasses[accent]) {
        btn.classList.add(...accentClasses[accent]);
      } else {
        btn.classList.add("bg-blue-600", "hover:bg-blue-700");
      }
    }
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const defaultOrg = { name: "MediCare", logo: "/images/Medicare-Emblem.png" };
    const fallbackOrg = { name: "Unknown Organization", logo: "/images/fallback-logo.png" };

    const orgId = localStorage.getItem("orgId");

    if (orgId) {
      fetch(`/api/organization/${orgId}`)
        .then(res => {
          if (!res.ok) throw new Error("Not Found");
          return res.json();
        })
        .then(org => {
          document.getElementById("orgName").textContent = org.name;
          
          document.getElementById("orgLogo").src = org.logo;
        })
        .catch(() => {
          document.getElementById("orgName").textContent = fallbackOrg.name;
        });
    } else {
      document.getElementById("orgName").textContent = defaultOrg.name;
    }
  });
</script>
<script>
 document.getElementById('printBtn').addEventListener('click', () => {
  const printContents = document.getElementById('confirmationSection').innerHTML;
  const originalContents = document.body.innerHTML;

  document.body.innerHTML = printContents;
  window.print();
  document.body.innerHTML = originalContents;
  window.location.reload(); 
});


</script>
</body>

</html>